<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE CUSKs #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unticked-promoted-constructors #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# OPTIONS_GHC -fprint-explicit-kinds #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.LSP.Server.Core</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><span class="hs-identifier">LogAction</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><span class="hs-identifier">Severity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-identifier">WithSeverity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-operator">(&lt;&amp;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Extra</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">at</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^?)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadCatch</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadMask</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadThrow</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fix</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Unlift</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Identity</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Product</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IxMap</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.LSP.Diagnostics.html"><span class="hs-identifier">Language.LSP.Diagnostics</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Capabilities</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.Misc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">prettyJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SMethodMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.SMethodMap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SMethodMap</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.LSP.VFS.html"><span class="hs-identifier">Language.LSP.VFS</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.VFS.html#end"><span class="hs-identifier">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-65"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Eta reduce&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-66"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Redundant do&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Reduce duplication&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">data</span><span> </span><span id="LspCoreLog"><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-var">LspCoreLog</span></a></span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- TODO: arguably it would be nicer to have the config object itself in there, but</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- then we're going to need 'Pretty config' constraints everywhere</span><span>
</span><span id="line-74"></span><span>    </span><span id="NewConfig"><span class="annot"><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-var">NewConfig</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ConfigurationParseError"><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-var">ConfigurationParseError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ConfigurationNotSupported"><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BadConfigurationResponse"><span class="annot"><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-var">BadConfigurationResponse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TResponseError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method_WorkspaceConfiguration</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WrongConfigSections"><span class="annot"><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-var">WrongConfigSections</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679207101"><span class="annot"><a href="#local-6989586621679207101"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span id="CantRegister"><span class="annot"><a href="Language.LSP.Server.Core.html#CantRegister"><span class="hs-identifier hs-var">CantRegister</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679207101"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="local-6989586621679207104"><span id="local-6989586621679207120"><span id="local-6989586621679207124"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679207133"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679207157"><span class="annot"><span class="annottext">pretty :: forall ann. LspCoreLog -&gt; Doc ann
</span><a href="#local-6989586621679207157"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-type">NewConfig</span></a></span><span> </span><span id="local-6989586621679207159"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679207159"><span class="hs-identifier hs-var">config</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: set new config:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc ann
forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679207159"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: not requesting configuration since the client does not support workspace/configuration&quot;</span></span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-type">ConfigurationParseError</span></a></span><span> </span><span id="local-6989586621679207161"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679207161"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span id="local-6989586621679207162"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679207162"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: configuration parse error:&quot;</span></span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679207162"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-90"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;when parsing&quot;</span></span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc ann
forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679207161"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-type">BadConfigurationResponse</span></a></span><span> </span><span id="local-6989586621679207164"><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679207164"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: error when requesting configuration: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
-&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann.
TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
-&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679207164"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-type">WrongConfigSections</span></a></span><span> </span><span id="local-6989586621679207165"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679207165"><span class="hs-identifier hs-var">sections</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: expected only one configuration section, got: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc ann
forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679207165"><span class="hs-identifier hs-var">sections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#CantRegister"><span class="hs-identifier hs-type">CantRegister</span></a></span><span> </span><span id="local-6989586621679207170"><span class="annot"><span class="annottext">SMethod @f @t m
</span><a href="#local-6989586621679207170"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: can't register dynamically for:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">SMethod @f @t m -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. SMethod @f @t m -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">SMethod @f @t m
</span><a href="#local-6989586621679207170"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">newtype</span><span> </span><span id="LspT"><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span></span><span> </span><span id="local-6989586621679206355"><span class="annot"><a href="#local-6989586621679206355"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span id="local-6989586621679206356"><span class="annot"><a href="#local-6989586621679206356"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679206357"><span class="annot"><a href="#local-6989586621679206357"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LspT"><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unLspT"><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a
</span><a href="Language.LSP.Server.Core.html#unLspT"><span class="hs-identifier hs-var hs-var">unLspT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206355"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679206356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206357"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207175"><span id="local-6989586621679207180"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b)
-&gt; (forall a b. a -&gt; LspT config m b -&gt; LspT config m a)
-&gt; Functor (LspT config m)
forall a b. a -&gt; LspT config m b -&gt; LspT config m a
forall a b. (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; LspT config m b -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall config (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
fmap :: forall a b. (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
$c&lt;$ :: forall config (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; LspT config m b -&gt; LspT config m a
&lt;$ :: forall a b. a -&gt; LspT config m b -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207190"><span id="local-6989586621679207195"><span id="local-6989586621679207199"><span id="local-6989586621679207203"><span id="local-6989586621679207207"><span class="annot"><span class="annottext">Functor (LspT config m)
Functor (LspT config m) =&gt;
(forall a. a -&gt; LspT config m a)
-&gt; (forall a b.
    LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c)
-&gt; (forall a b.
    LspT config m a -&gt; LspT config m b -&gt; LspT config m b)
-&gt; (forall a b.
    LspT config m a -&gt; LspT config m b -&gt; LspT config m a)
-&gt; Applicative (LspT config m)
forall a. a -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall a b.
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
forall config (m :: * -&gt; *).
Applicative m =&gt;
Functor (LspT config m)
forall config (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall config (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall config (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; LspT config m a
pure :: forall a. a -&gt; LspT config m a
$c&lt;*&gt; :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
&lt;*&gt; :: forall a b.
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
$cliftA2 :: forall config (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
$c*&gt; :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
*&gt; :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
$c&lt;* :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m a
&lt;* :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207218"><span id="local-6989586621679207223"><span id="local-6989586621679207227"><span class="annot"><span class="annottext">Applicative (LspT config m)
Applicative (LspT config m) =&gt;
(forall a b.
 LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b)
-&gt; (forall a b.
    LspT config m a -&gt; LspT config m b -&gt; LspT config m b)
-&gt; (forall a. a -&gt; LspT config m a)
-&gt; Monad (LspT config m)
forall a. a -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall a b.
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
forall config (m :: * -&gt; *). Monad m =&gt; Applicative (LspT config m)
forall config (m :: * -&gt; *) a. Monad m =&gt; a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
&gt;&gt;= :: forall a b.
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
$c&gt;&gt; :: forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
&gt;&gt; :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
$creturn :: forall config (m :: * -&gt; *) a. Monad m =&gt; a -&gt; LspT config m a
return :: forall a. a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207244"><span class="annot"><span class="annottext">MonadThrow (LspT config m)
MonadThrow (LspT config m) =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a)
-&gt; MonadCatch (LspT config m)
forall e a.
(HasCallStack, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
forall config (m :: * -&gt; *).
MonadCatch m =&gt;
MonadThrow (LspT config m)
forall config (m :: * -&gt; *) e a.
(MonadCatch m, HasCallStack, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
$ccatch :: forall config (m :: * -&gt; *) e a.
(MonadCatch m, HasCallStack, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207261"><span class="annot"><span class="annottext">Monad (LspT config m)
Monad (LspT config m) =&gt;
(forall a. IO a -&gt; LspT config m a) -&gt; MonadIO (LspT config m)
forall a. IO a -&gt; LspT config m a
forall config (m :: * -&gt; *). MonadIO m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall config (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; LspT config m a
liftIO :: forall a. IO a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207276"><span id="local-6989586621679207287"><span id="local-6989586621679207297"><span class="annot"><span class="annottext">MonadCatch (LspT config m)
MonadCatch (LspT config m) =&gt;
(forall b.
 HasCallStack =&gt;
 ((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
 -&gt; LspT config m b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
    -&gt; LspT config m b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    LspT config m a
    -&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
    -&gt; (a -&gt; LspT config m b)
    -&gt; LspT config m (b, c))
-&gt; MonadMask (LspT config m)
forall b.
HasCallStack =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
forall a b c.
HasCallStack =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
forall config (m :: * -&gt; *).
MonadMask m =&gt;
MonadCatch (LspT config m)
forall config (m :: * -&gt; *) b.
(MonadMask m, HasCallStack) =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
forall config (m :: * -&gt; *) a b c.
(MonadMask m, HasCallStack) =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
forall (m :: * -&gt; *).
MonadCatch m =&gt;
(forall b. HasCallStack =&gt; ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
$cmask :: forall config (m :: * -&gt; *) b.
(MonadMask m, HasCallStack) =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
mask :: forall b.
HasCallStack =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
$cuninterruptibleMask :: forall config (m :: * -&gt; *) b.
(MonadMask m, HasCallStack) =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
uninterruptibleMask :: forall b.
HasCallStack =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
$cgeneralBracket :: forall config (m :: * -&gt; *) a b c.
(MonadMask m, HasCallStack) =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
generalBracket :: forall a b c.
HasCallStack =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207316"><span class="annot"><span class="annottext">Monad (LspT config m)
Monad (LspT config m) =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; LspT config m a)
-&gt; MonadThrow (LspT config m)
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; LspT config m a
forall config (m :: * -&gt; *). MonadThrow m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) e a.
(MonadThrow m, HasCallStack, Exception e) =&gt;
e -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
$cthrowM :: forall config (m :: * -&gt; *) e a.
(MonadThrow m, HasCallStack, Exception e) =&gt;
e -&gt; LspT config m a
throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207332"><span class="annot"><span class="annottext">(forall (m :: * -&gt; *). Monad m =&gt; Monad (LspT config m)) =&gt;
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a)
-&gt; MonadTrans (LspT config)
forall config (m :: * -&gt; *). Monad m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
forall (m :: * -&gt; *). Monad m =&gt; Monad (LspT config m)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *). Monad m =&gt; Monad (t m)) =&gt;
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
$clift :: forall config (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadTrans</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207345"><span class="annot"><span class="annottext">MonadIO (LspT config m)
MonadIO (LspT config m) =&gt;
(forall b.
 ((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b)
-&gt; MonadUnliftIO (LspT config m)
forall b.
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
forall config (m :: * -&gt; *).
MonadUnliftIO m =&gt;
MonadIO (LspT config m)
forall config (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
$cwithRunInIO :: forall config (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
withRunInIO :: forall b.
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207357"><span class="annot"><span class="annottext">Monad (LspT config m)
Monad (LspT config m) =&gt;
(forall a. (a -&gt; LspT config m a) -&gt; LspT config m a)
-&gt; MonadFix (LspT config m)
forall a. (a -&gt; LspT config m a) -&gt; LspT config m a
forall config (m :: * -&gt; *). MonadFix m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; LspT config m a) -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
$cmfix :: forall config (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; LspT config m a) -&gt; LspT config m a
mfix :: forall a. (a -&gt; LspT config m a) -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207367"><span id="local-6989586621679207373"><span id="local-6989586621679207380"><span class="annot"><span class="annottext">NonEmpty (LspT config m a) -&gt; LspT config m a
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
(LspT config m a -&gt; LspT config m a -&gt; LspT config m a)
-&gt; (NonEmpty (LspT config m a) -&gt; LspT config m a)
-&gt; (forall b.
    Integral b =&gt;
    b -&gt; LspT config m a -&gt; LspT config m a)
-&gt; Semigroup (LspT config m a)
forall b. Integral b =&gt; b -&gt; LspT config m a -&gt; LspT config m a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
NonEmpty (LspT config m a) -&gt; LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
(Applicative m, Semigroup a, Integral b) =&gt;
b -&gt; LspT config m a -&gt; LspT config m a
$c&lt;&gt; :: forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
&lt;&gt; :: LspT config m a -&gt; LspT config m a -&gt; LspT config m a
$csconcat :: forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
NonEmpty (LspT config m a) -&gt; LspT config m a
sconcat :: NonEmpty (LspT config m a) -&gt; LspT config m a
$cstimes :: forall config (m :: * -&gt; *) a b.
(Applicative m, Semigroup a, Integral b) =&gt;
b -&gt; LspT config m a -&gt; LspT config m a
stimes :: forall b. Integral b =&gt; b -&gt; LspT config m a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207394"><span id="local-6989586621679207400"><span id="local-6989586621679207405"><span class="annot"><span class="annottext">Semigroup (LspT config m a)
LspT config m a
Semigroup (LspT config m a) =&gt;
LspT config m a
-&gt; (LspT config m a -&gt; LspT config m a -&gt; LspT config m a)
-&gt; ([LspT config m a] -&gt; LspT config m a)
-&gt; Monoid (LspT config m a)
[LspT config m a] -&gt; LspT config m a
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
Semigroup (LspT config m a)
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
[LspT config m a] -&gt; LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
$cmempty :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a
mempty :: LspT config m a
$cmappend :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
mappend :: LspT config m a -&gt; LspT config m a -&gt; LspT config m a
$cmconcat :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
[LspT config m a] -&gt; LspT config m a
mconcat :: [LspT config m a] -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206355"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206356"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679206357"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- for deriving the instance of MonadUnliftIO</span><span>
</span><span id="line-102"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><span class="hs-identifier">representational</span></span><span> </span><span class="annot"><span class="hs-identifier">representational</span></span><span> </span><span class="annot"><span class="hs-identifier">nominal</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span id="local-6989586621679206536"><span id="local-6989586621679206537"><span id="local-6989586621679206538"><span class="annot"><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-identifier hs-type">runLspT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206536"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206536"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206538"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206538"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-105"></span><span id="runLspT"><span class="annot"><span class="annottext">runLspT :: forall config (m :: * -&gt; *) a.
LanguageContextEnv config -&gt; LspT config m a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-identifier hs-var hs-var">runLspT</span></a></span></span><span> </span><span id="local-6989586621679207413"><span class="annot"><span class="annottext">LanguageContextEnv config
</span><a href="#local-6989586621679207413"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ReaderT (LanguageContextEnv config) m a
 -&gt; LanguageContextEnv config -&gt; m a)
-&gt; LanguageContextEnv config
-&gt; ReaderT (LanguageContextEnv config) m a
-&gt; m a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) m a
-&gt; LanguageContextEnv config -&gt; m a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config
</span><a href="#local-6989586621679207413"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (LanguageContextEnv config) m a -&gt; m a)
-&gt; (LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a)
-&gt; LspT config m a
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a
forall config (m :: * -&gt; *) a.
LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a
</span><a href="Language.LSP.Server.Core.html#unLspT"><span class="hs-identifier hs-var">unLspT</span></a></span><span>
</span><span id="line-106"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-pragma hs-type">runLspT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">type</span><span> </span><span id="LspM"><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-var">LspM</span></a></span></span><span> </span><span id="local-6989586621679207417"><span class="annot"><a href="#local-6989586621679207417"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207417"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679206552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadLsp"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-var">MonadLsp</span></a></span></span><span> </span><span id="local-6989586621679206551"><span class="annot"><a href="#local-6989586621679206551"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span id="local-6989586621679206552"><span class="annot"><a href="#local-6989586621679206552"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679206552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206551"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>  </span><span id="getLspEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-type">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679206552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206551"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679206556"><span id="local-6989586621679206557"><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679206556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206557"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206557"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">instance</span><span> </span><span id="local-6989586621679207428"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-pragma hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207428"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-pragma hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207428"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span class="hs-pragma">)</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-pragma hs-type">getLspEnv</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679207430"><span class="annot"><span class="annottext">getLspEnv :: LspT config m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) m (LanguageContextEnv config)
-&gt; LspT config m (LanguageContextEnv config)
forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) m (LanguageContextEnv config)
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679206563"><span id="local-6989586621679206564"><span id="local-6989586621679206565"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206563"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206564"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206563"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679206565"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206564"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">instance</span><span> </span><span id="local-6989586621679207440"><span id="local-6989586621679207441"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-pragma hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207440"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679207441"><span class="hs-pragma hs-type">r</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-pragma hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207440"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-pragma hs-type">getLspEnv</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679207445"><span class="annot"><span class="annottext">getLspEnv :: ReaderT r m (LanguageContextEnv c)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv c) -&gt; ReaderT r m (LanguageContextEnv c)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv c)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679206570"><span id="local-6989586621679206571"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206570"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206571"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206570"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IdentityT</span></span><span> </span><span class="annot"><a href="#local-6989586621679206571"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679207460"><span class="annot"><span class="annottext">getLspEnv :: IdentityT @(*) m (LanguageContextEnv c)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv c) -&gt; IdentityT @(*) m (LanguageContextEnv c)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; IdentityT @(*) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv c)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">data</span><span> </span><span id="LanguageContextEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-var">LanguageContextEnv</span></a></span></span><span> </span><span id="local-6989586621679206572"><span class="annot"><a href="#local-6989586621679206572"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LanguageContextEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-var">LanguageContextEnv</span></a></span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="resHandlers"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Handlers IO
</span><a href="Language.LSP.Server.Core.html#resHandlers"><span class="hs-identifier hs-var hs-var">resHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resConfigSection"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#resConfigSection"><span class="hs-identifier hs-var hs-var">resConfigSection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resParseConfig"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#resParseConfig"><span class="hs-identifier hs-var hs-var">resParseConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206572"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679206572"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resOnConfigChange"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; config -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resOnConfigChange"><span class="hs-identifier hs-var hs-var">resOnConfigChange</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206572"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resSendMessage"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resSendMessage"><span class="hs-identifier hs-var hs-var">resSendMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromServerMessage</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- We keep the state in a TVar to be thread safe</span><span>
</span><span id="line-133"></span><span>    </span><span id="resState"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var hs-var">resState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206572"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resClientCapabilities"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var hs-var">resClientCapabilities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">L.ClientCapabilities</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRootPath"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#resRootPath"><span class="hs-identifier hs-var hs-var">resRootPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resProgressStartDelay"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Int
</span><a href="Language.LSP.Server.Core.html#resProgressStartDelay"><span class="hs-identifier hs-var hs-var">resProgressStartDelay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The delay before starting a progress reporting session, in microseconds</span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resProgressUpdateDelay"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Int
</span><a href="Language.LSP.Server.Core.html#resProgressUpdateDelay"><span class="hs-identifier hs-var hs-var">resProgressUpdateDelay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The delay between sending progress updates, in microseconds</span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- Handlers</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-comment">{- | A mapping from methods to the static 'Handler's that should be used to
 handle responses when they come in from the client. To build up a 'Handlers',
 you should 'mconcat' a list of 'notificationHandler' and 'requestHandler's:

 @
 mconcat [
   notificationHandler SInitialized $ \notif -&gt; pure ()
 , requestHandler STextDocumentHover $ \req responder -&gt; pure ()
 ]
 @
-}</span></span><span>
</span><span id="line-157"></span><span class="hs-keyword">data</span><span> </span><span id="Handlers"><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span> </span><span id="local-6989586621679206587"><span class="annot"><a href="#local-6989586621679206587"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Handlers"><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="reqHandlers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="Language.LSP.Server.Core.html#reqHandlers"><span class="hs-identifier hs-var hs-var">reqHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206587"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="notHandlers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
</span><a href="Language.LSP.Server.Core.html#notHandlers"><span class="hs-identifier hs-var hs-var">notHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206587"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679206596"><span id="local-6989586621679207480"><span id="local-6989586621679207484"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206596"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679207491"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679207491"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679207492"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679207492"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621679207493"><span class="annot"><span class="annottext">&lt;&gt; :: Handlers config -&gt; Handlers config -&gt; Handlers config
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679207494"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679207494"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621679207495"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679207495"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler config 'Notification)
-&gt; Handlers config
forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679207491"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler config 'Request)
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler config 'Request)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679207494"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679207492"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler config 'Notification)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler config 'Notification)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679207495"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679206601"><span id="local-6989586621679207500"><span id="local-6989586621679207504"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206601"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679207509"><span class="annot"><span class="annottext">mempty :: Handlers config
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler config 'Notification)
-&gt; Handlers config
forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Language.LSP.Server.Core.html#notificationHandler"><span class="hs-identifier hs-type">notificationHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206605"><span class="annot"><a href="#local-6989586621679206605"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206606"><span class="annot"><a href="#local-6989586621679206606"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206605"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206606"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206605"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206606"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-168"></span><span id="notificationHandler"><span class="annot"><span class="annottext">notificationHandler :: forall (m :: Method 'ClientToServer 'Notification) (f :: * -&gt; *).
SMethod @'ClientToServer @'Notification m
-&gt; Handler @'ClientToServer @'Notification f m -&gt; Handlers f
</span><a href="Language.LSP.Server.Core.html#notificationHandler"><span class="hs-identifier hs-var hs-var">notificationHandler</span></a></span></span><span> </span><span id="local-6989586621679207511"><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
</span><a href="#local-6989586621679207511"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679207512"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification f m
</span><a href="#local-6989586621679207512"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler f 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler f 'Notification)
-&gt; Handlers f
forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler f 'Request)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
-&gt; ClientMessageHandler f 'Notification m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler f 'Notification)
forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
</span><a href="#local-6989586621679207511"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification f m
-&gt; ClientMessageHandler f 'Notification m
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification f m
</span><a href="#local-6989586621679207512"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Language.LSP.Server.Core.html#requestHandler"><span class="hs-identifier hs-type">requestHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206617"><span class="annot"><a href="#local-6989586621679206617"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206618"><span class="annot"><a href="#local-6989586621679206618"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206618"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206618"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-171"></span><span id="requestHandler"><span class="annot"><span class="annottext">requestHandler :: forall (m :: Method 'ClientToServer 'Request) (f :: * -&gt; *).
SMethod @'ClientToServer @'Request m
-&gt; Handler @'ClientToServer @'Request f m -&gt; Handlers f
</span><a href="Language.LSP.Server.Core.html#requestHandler"><span class="hs-identifier hs-var hs-var">requestHandler</span></a></span></span><span> </span><span id="local-6989586621679207516"><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
</span><a href="#local-6989586621679207516"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679207517"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request f m
</span><a href="#local-6989586621679207517"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler f 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler f 'Notification)
-&gt; Handlers f
forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
-&gt; ClientMessageHandler f 'Request m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler f 'Request)
forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
</span><a href="#local-6989586621679207516"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request f m
-&gt; ClientMessageHandler f 'Request m
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request f m
</span><a href="#local-6989586621679207517"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler f 'Notification)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><span class="hs-comment">-- | Wrapper to restrict 'Handler's to  ClientToServer' 'Method's</span></span><span>
</span><span id="line-174"></span><span class="hs-keyword">newtype</span><span> </span><span id="ClientMessageHandler"><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span></span><span> </span><span id="local-6989586621679206615"><span class="annot"><a href="#local-6989586621679206615"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206614"><span class="annot"><a href="#local-6989586621679206614"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageKind</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206616"><span class="annot"><a href="#local-6989586621679206616"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679206614"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClientMessageHandler"><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206615"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206616"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><span class="hs-comment">{- | The type of a handler that handles requests and notifications coming in
 from the server or client
-}</span></span><span>
</span><span id="line-179"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207518"><span class="annot"><a href="#local-6989586621679207518"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span id="local-6989586621679207519"><span id="local-6989586621679207520"><span> </span><span class="hs-special">(</span><span id="local-6989586621679207521"><span class="annot"><a href="#local-6989586621679207521"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679207519"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207520"><span class="hs-identifier hs-type">t</span></a></span></span></span><span id="local-6989586621679207519"><span id="local-6989586621679207520"></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207522"><span class="annot"><a href="#local-6989586621679207522"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679207522"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207518"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207520"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207521"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>  </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621679207523"><span id="local-6989586621679207524"><span id="local-6989586621679207525"><span class="annot"><a href="#local-6989586621679207523"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679207525"><span class="hs-identifier hs-type">_from</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TRequestMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679207524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TResponseError</span></span><span> </span><span class="annot"><a href="#local-6989586621679207524"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679207524"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207523"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207523"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621679207526"><span id="local-6989586621679207527"><span id="local-6989586621679207528"><span class="annot"><a href="#local-6989586621679207526"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207527"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679207528"><span class="hs-identifier hs-type">_from</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TNotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679207527"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207526"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">-- | How to convert two isomorphic data structures between each other.</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="local-6989586621679206622"><span class="annot"><a href="#local-6989586621679206622"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="%3C~%3E"><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-var">&lt;~&gt;</span></a></span></span><span> </span><span id="local-6989586621679206623"><span class="annot"><a href="#local-6989586621679206623"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Iso"><span class="annot"><a href="Language.LSP.Server.Core.html#Iso"><span class="hs-identifier hs-var">Iso</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="forward"><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679206625"><span class="annot"><a href="#local-6989586621679206625"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679206622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206625"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206623"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206625"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="backward"><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). n a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#backward"><span class="hs-identifier hs-var hs-var">backward</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679206630"><span class="annot"><a href="#local-6989586621679206630"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679206623"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206630"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206630"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span id="local-6989586621679206635"><span id="local-6989586621679206636"><span class="annot"><a href="Language.LSP.Server.Core.html#transmuteHandlers"><span class="hs-identifier hs-type">transmuteHandlers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206635"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-type">&lt;~&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206636"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206635"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206636"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-190"></span><span id="transmuteHandlers"><span class="annot"><span class="annottext">transmuteHandlers :: forall (m :: * -&gt; *) (n :: * -&gt; *).
(&lt;~&gt;) @(*) m n -&gt; Handlers m -&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#transmuteHandlers"><span class="hs-identifier hs-var hs-var">transmuteHandlers</span></a></span></span><span> </span><span id="local-6989586621679207533"><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679207533"><span class="hs-identifier hs-var">nat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (a :: Method 'ClientToServer 'Request).
 Handler @'ClientToServer @'Request m a
 -&gt; Handler @'ClientToServer @'Request n a)
-&gt; (forall (a :: Method 'ClientToServer 'Notification).
    Handler @'ClientToServer @'Notification m a
    -&gt; Handler @'ClientToServer @'Notification n a)
-&gt; Handlers m
-&gt; Handlers n
forall (m :: * -&gt; *) (n :: * -&gt; *).
(forall (a :: Method 'ClientToServer 'Request).
 Handler @'ClientToServer @'Request m a
 -&gt; Handler @'ClientToServer @'Request n a)
-&gt; (forall (a :: Method 'ClientToServer 'Notification).
    Handler @'ClientToServer @'Notification m a
    -&gt; Handler @'ClientToServer @'Notification n a)
-&gt; Handlers m
-&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-var">mapHandlers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679207535"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679207535"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679207536"><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer a
</span><a href="#local-6989586621679207536"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679207537"><span class="annot"><span class="annottext">Either
  (TResponseError @'ClientToServer a)
  (MessageResult @'ClientToServer @'Request a)
-&gt; n ()
</span><a href="#local-6989586621679207537"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n -&gt; forall a. m a -&gt; n a
forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679207533"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
TRequestMessage @'ClientToServer a
-&gt; (Either
      (TResponseError @'ClientToServer a)
      (MessageResult @'ClientToServer @'Request a)
    -&gt; m ())
-&gt; m ()
</span><a href="#local-6989586621679207535"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer a
</span><a href="#local-6989586621679207536"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n -&gt; forall a. n a -&gt; m a
forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). n a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#backward"><span class="hs-identifier hs-var">backward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679207533"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="annot"><span class="annottext">(n () -&gt; m ())
-&gt; (Either
      (TResponseError @'ClientToServer a)
      (MessageResult @'ClientToServer @'Request a)
    -&gt; n ())
-&gt; Either
     (TResponseError @'ClientToServer a)
     (MessageResult @'ClientToServer @'Request a)
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either
  (TResponseError @'ClientToServer a)
  (MessageResult @'ClientToServer @'Request a)
-&gt; n ()
</span><a href="#local-6989586621679207537"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679207538"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679207538"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679207539"><span class="annot"><span class="annottext">TNotificationMessage @'ClientToServer a
</span><a href="#local-6989586621679207539"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n -&gt; forall a. m a -&gt; n a
forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679207533"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
TNotificationMessage @'ClientToServer a -&gt; m ()
</span><a href="#local-6989586621679207538"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ClientToServer a
</span><a href="#local-6989586621679207539"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span id="local-6989586621679206641"><span id="local-6989586621679206642"><span class="annot"><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-type">mapHandlers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206639"><span class="annot"><a href="#local-6989586621679206639"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206639"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206642"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206639"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206640"><span class="annot"><a href="#local-6989586621679206640"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206640"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206642"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206640"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206642"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-197"></span><span id="mapHandlers"><span class="annot"><span class="annottext">mapHandlers :: forall (m :: * -&gt; *) (n :: * -&gt; *).
(forall (a :: Method 'ClientToServer 'Request).
 Handler @'ClientToServer @'Request m a
 -&gt; Handler @'ClientToServer @'Request n a)
-&gt; (forall (a :: Method 'ClientToServer 'Notification).
    Handler @'ClientToServer @'Notification m a
    -&gt; Handler @'ClientToServer @'Notification n a)
-&gt; Handlers m
-&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-var hs-var">mapHandlers</span></a></span></span><span> </span><span id="local-6989586621679207540"><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Request).
Handler @'ClientToServer @'Request m a
-&gt; Handler @'ClientToServer @'Request n a
</span><a href="#local-6989586621679207540"><span class="hs-identifier hs-var">mapReq</span></a></span></span><span> </span><span id="local-6989586621679207541"><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Notification).
Handler @'ClientToServer @'Notification m a
-&gt; Handler @'ClientToServer @'Notification n a
</span><a href="#local-6989586621679207541"><span class="hs-identifier hs-var">mapNot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679207542"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="#local-6989586621679207542"><span class="hs-identifier hs-var">reqs</span></a></span></span><span> </span><span id="local-6989586621679207543"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler m 'Notification)
</span><a href="#local-6989586621679207543"><span class="hs-identifier hs-var">nots</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler n 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler n 'Notification)
-&gt; Handlers n
forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler n 'Request)
</span><a href="#local-6989586621679207544"><span class="hs-identifier hs-var">reqs'</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler n 'Notification)
</span><a href="#local-6989586621679207545"><span class="hs-identifier hs-var">nots'</span></a></span><span>
</span><span id="line-198"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621679207544"><span class="annot"><span class="annottext">reqs' :: SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler n 'Request)
</span><a href="#local-6989586621679207544"><span class="hs-identifier hs-var hs-var">reqs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (a :: Method 'ClientToServer 'Request).
 ClientMessageHandler m 'Request a
 -&gt; ClientMessageHandler n 'Request a)
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler n 'Request)
forall {f :: MessageDirection} {t :: MessageKind}
       (u :: Method f t -&gt; *) (v :: Method f t -&gt; *).
(forall (a :: Method f t). u a -&gt; v a)
-&gt; SMethodMap @f @t u -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span id="local-6989586621679207547"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679207547"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request n a
-&gt; ClientMessageHandler n 'Request a
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler @'ClientToServer @'Request n a
 -&gt; ClientMessageHandler n 'Request a)
-&gt; Handler @'ClientToServer @'Request n a
-&gt; ClientMessageHandler n 'Request a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
-&gt; Handler @'ClientToServer @'Request n a
forall (a :: Method 'ClientToServer 'Request).
Handler @'ClientToServer @'Request m a
-&gt; Handler @'ClientToServer @'Request n a
</span><a href="#local-6989586621679207540"><span class="hs-identifier hs-var">mapReq</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679207547"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="#local-6989586621679207542"><span class="hs-identifier hs-var">reqs</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621679207545"><span class="annot"><span class="annottext">nots' :: SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler n 'Notification)
</span><a href="#local-6989586621679207545"><span class="hs-identifier hs-var hs-var">nots'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (a :: Method 'ClientToServer 'Notification).
 ClientMessageHandler m 'Notification a
 -&gt; ClientMessageHandler n 'Notification a)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler n 'Notification)
forall {f :: MessageDirection} {t :: MessageKind}
       (u :: Method f t -&gt; *) (v :: Method f t -&gt; *).
(forall (a :: Method f t). u a -&gt; v a)
-&gt; SMethodMap @f @t u -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span id="local-6989586621679207548"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679207548"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification n a
-&gt; ClientMessageHandler n 'Notification a
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler @'ClientToServer @'Notification n a
 -&gt; ClientMessageHandler n 'Notification a)
-&gt; Handler @'ClientToServer @'Notification n a
-&gt; ClientMessageHandler n 'Notification a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
-&gt; Handler @'ClientToServer @'Notification n a
forall (a :: Method 'ClientToServer 'Notification).
Handler @'ClientToServer @'Notification m a
-&gt; Handler @'ClientToServer @'Notification n a
</span><a href="#local-6989586621679207541"><span class="hs-identifier hs-var">mapNot</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679207548"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler m 'Notification)
</span><a href="#local-6989586621679207543"><span class="hs-identifier hs-var">nots</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><span class="hs-comment">-- | state used by the LSP dispatcher to manage the message loop</span></span><span>
</span><span id="line-203"></span><span class="hs-keyword">data</span><span> </span><span id="LanguageContextState"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-var">LanguageContextState</span></a></span></span><span> </span><span id="local-6989586621679206661"><span class="annot"><a href="#local-6989586621679206661"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LanguageContextState"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-var">LanguageContextState</span></a></span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="resVFS"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var hs-var">resVFS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-type">VFSData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resDiagnostics"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var hs-var">resDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Diagnostics.html#DiagnosticStore"><span class="hs-identifier hs-type">DiagnosticStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resConfig"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var hs-var">resConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206661"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resWorkspaceFolders"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar [WorkspaceFolder]
</span><a href="Language.LSP.Server.Core.html#resWorkspaceFolders"><span class="hs-identifier hs-var hs-var">resWorkspaceFolders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">WorkspaceFolder</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resProgressData"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; ProgressData
</span><a href="Language.LSP.Server.Core.html#resProgressData"><span class="hs-identifier hs-var hs-var">resProgressData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-type">ProgressData</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resPendingResponses"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar ResponseMap
</span><a href="Language.LSP.Server.Core.html#resPendingResponses"><span class="hs-identifier hs-var hs-var">resPendingResponses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ResponseMap"><span class="hs-identifier hs-type">ResponseMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRegistrationsNot"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var hs-var">resRegistrationsNot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-type">RegistrationMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRegistrationsReq"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var hs-var">resRegistrationsReq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-type">RegistrationMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resLspId"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#resLspId"><span class="hs-identifier hs-var hs-var">resLspId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resShutdown"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; Barrier ()
</span><a href="Language.LSP.Server.Core.html#resShutdown"><span class="hs-identifier hs-var hs-var">resShutdown</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Barrier</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-comment">-- ^ Has the server received 'shutdown'? Can be used to conveniently trigger e.g. thread termination,</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-comment">-- but if you need a cleanup action to terminate before exiting, then you should install a full</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-comment">-- 'shutdown' handler</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-keyword">type</span><span> </span><span id="ResponseMap"><span class="annot"><a href="Language.LSP.Server.Core.html#ResponseMap"><span class="hs-identifier hs-var">ResponseMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IxMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-type">ServerResponseCallback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-keyword">type</span><span> </span><span id="RegistrationMap"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-var">RegistrationMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207560"><span class="annot"><a href="#local-6989586621679207560"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageKind</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679207560"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">data</span><span> </span><span id="RegistrationToken"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206960"><span id="local-6989586621679206961"><span class="annot"><a href="#local-6989586621679206961"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679206960"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RegistrationToken"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206961"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206961"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span class="hs-keyword">newtype</span><span> </span><span id="RegistrationId"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206957"><span id="local-6989586621679206958"><span class="annot"><a href="#local-6989586621679206958"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679206957"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RegistrationId"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207564"><span id="local-6989586621679207569"><span class="annot"><span class="annottext">RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
(RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool)
-&gt; (RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool)
-&gt; Eq (RegistrationId @t m)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
$c== :: forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
== :: RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
$c/= :: forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
/= :: RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-keyword">data</span><span> </span><span id="ProgressData"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-var">ProgressData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProgressData"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-var">ProgressData</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="progressNextId"><span class="annot"><span class="annottext">ProgressData -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#progressNextId"><span class="hs-identifier hs-var hs-var">progressNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="progressCancel"><span class="annot"><span class="annottext">ProgressData -&gt; TVar (Map ProgressToken (IO ()))
</span><a href="Language.LSP.Server.Core.html#progressCancel"><span class="hs-identifier hs-var hs-var">progressCancel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProgressToken</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-keyword">data</span><span> </span><span id="VFSData"><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-var">VFSData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VFSData"><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-var">VFSData</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vfsData"><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var hs-var">vfsData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="reverseMap"><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var hs-var">reverseMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-pragma hs-type">modifyState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-238"></span><span id="local-6989586621679206688"><span id="local-6989586621679206689"><span id="local-6989586621679206690"><span class="annot"><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-type">modifyState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206688"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206689"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206688"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206690"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206690"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206690"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206689"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-239"></span><span id="modifyState"><span class="annot"><span class="annottext">modifyState :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var hs-var">modifyState</span></a></span></span><span> </span><span id="local-6989586621679207588"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207588"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621679207589"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679207589"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679207590"><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679207590"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
</span><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-identifier hs-var">getStateVar</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207588"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar a -&gt; (a -&gt; a) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679207590"><span class="hs-identifier hs-var">tvarDat</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679207589"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-pragma hs-type">stateState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-244"></span><span id="local-6989586621679206700"><span id="local-6989586621679206701"><span id="local-6989586621679206702"><span id="local-6989586621679206703"><span class="annot"><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-type">stateState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206700"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206701"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206700"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206702"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206702"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679206703"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679206702"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206701"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206703"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-245"></span><span id="stateState"><span class="annot"><span class="annottext">stateState :: forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var hs-var">stateState</span></a></span></span><span> </span><span id="local-6989586621679207603"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar s
</span><a href="#local-6989586621679207603"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621679207604"><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679207604"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679207605"><span class="annot"><span class="annottext">TVar s
</span><a href="#local-6989586621679207605"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar s) -&gt; m (TVar s)
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
</span><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-identifier hs-var">getStateVar</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar s
</span><a href="#local-6989586621679207603"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM a -&gt; IO a
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM a -&gt; IO a) -&gt; STM a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar s -&gt; (s -&gt; (a, s)) -&gt; STM a
forall s a. TVar s -&gt; (s -&gt; (a, s)) -&gt; STM a
</span><span class="hs-identifier hs-var">stateTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar s
</span><a href="#local-6989586621679207605"><span class="hs-identifier hs-var">tvarDat</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679207604"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-pragma hs-type">getsState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-250"></span><span id="local-6989586621679206710"><span id="local-6989586621679206711"><span id="local-6989586621679206712"><span class="annot"><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-type">getsState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206710"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206710"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206712"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-251"></span><span id="getsState"><span class="annot"><span class="annottext">getsState :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var hs-var">getsState</span></a></span></span><span> </span><span id="local-6989586621679207615"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207615"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621679207616"><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679207616"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
</span><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-identifier hs-var">getStateVar</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207615"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar a -&gt; IO a
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679207616"><span class="hs-identifier hs-var">tvarDat</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-pragma hs-type">getStateVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-256"></span><span id="local-6989586621679206694"><span id="local-6989586621679206695"><span id="local-6989586621679206696"><span class="annot"><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-identifier hs-type">getStateVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206694"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206694"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679206696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-257"></span><span id="getStateVar"><span class="annot"><span class="annottext">getStateVar :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m (TVar a)
</span><a href="Language.LSP.Server.Core.html#getStateVar"><span class="hs-identifier hs-var hs-var">getStateVar</span></a></span></span><span> </span><span id="local-6989586621679207626"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207626"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679207626"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar a)
-&gt; (LanguageContextEnv config -&gt; LanguageContextState config)
-&gt; LanguageContextEnv config
-&gt; TVar a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; LanguageContextState config
forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; TVar a)
-&gt; m (LanguageContextEnv config) -&gt; m (TVar a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><span class="hs-comment">{- | Options that the server may configure.
 If you set handlers for some requests, you may need to set some of these options.
-}</span></span><span>
</span><span id="line-264"></span><span class="hs-keyword">data</span><span> </span><span id="Options"><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Options"><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="optTextDocumentSync"><span class="annot"><span class="annottext">Options -&gt; Maybe TextDocumentSyncOptions
</span><a href="Language.LSP.Server.Core.html#optTextDocumentSync"><span class="hs-identifier hs-var hs-var">optTextDocumentSync</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.TextDocumentSyncOptions</span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optCompletionTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optCompletionTriggerCharacters"><span class="hs-identifier hs-var hs-var">optCompletionTriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^  The characters that trigger completion automatically.</span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optCompletionAllCommitCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optCompletionAllCommitCharacters"><span class="hs-identifier hs-var hs-var">optCompletionAllCommitCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-comment">-- ^ The list of all possible characters that commit a completion. This field can be used</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-comment">-- if clients don't support individual commit characters per completion item. See</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-comment">-- `_commitCharactersSupport`.</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optSignatureHelpTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optSignatureHelpTriggerCharacters"><span class="hs-identifier hs-var hs-var">optSignatureHelpTriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The characters that trigger signature help automatically.</span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optSignatureHelpRetriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optSignatureHelpRetriggerCharacters"><span class="hs-identifier hs-var hs-var">optSignatureHelpRetriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-comment">-- ^ List of characters that re-trigger signature help.</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-comment">-- These trigger characters are only active when signature help is already showing. All trigger characters</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-comment">-- are also counted as re-trigger characters.</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optCodeActionKinds"><span class="annot"><span class="annottext">Options -&gt; Maybe [CodeActionKind]
</span><a href="Language.LSP.Server.Core.html#optCodeActionKinds"><span class="hs-identifier hs-var hs-var">optCodeActionKinds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">CodeActionKind</span></span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-comment">-- ^ CodeActionKinds that this server may return.</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-comment">-- The list of kinds may be generic, such as `CodeActionKind.Refactor`, or the server</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-comment">-- may list out every specific kind they provide.</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optDocumentOnTypeFormattingTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe (NonEmpty Char)
</span><a href="Language.LSP.Server.Core.html#optDocumentOnTypeFormattingTriggerCharacters"><span class="hs-identifier hs-var hs-var">optDocumentOnTypeFormattingTriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-comment">-- ^ The list of characters that triggers on type formatting.</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-comment">-- If you set `documentOnTypeFormattingHandler`, you **must** set this.</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-comment">-- The first character is mandatory, so a 'NonEmpty' should be passed.</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optExecuteCommandCommands"><span class="annot"><span class="annottext">Options -&gt; Maybe [Text]
</span><a href="Language.LSP.Server.Core.html#optExecuteCommandCommands"><span class="hs-identifier hs-var hs-var">optExecuteCommandCommands</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- ^ The commands to be executed on the server.</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-comment">-- If you set `executeCommandHandler`, you **must** set this.</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optServerInfo"><span class="annot"><span class="annottext">Options -&gt; Maybe ServerInfo
</span><a href="Language.LSP.Server.Core.html#optServerInfo"><span class="hs-identifier hs-var hs-var">optServerInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerInfo</span></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Information about the server that can be advertised to the client.</span></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optSupportClientInitiatedProgress"><span class="annot"><span class="annottext">Options -&gt; Bool
</span><a href="Language.LSP.Server.Core.html#optSupportClientInitiatedProgress"><span class="hs-identifier hs-var hs-var">optSupportClientInitiatedProgress</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Whether or not to support client-initiated progress.</span></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optProgressStartDelay"><span class="annot"><span class="annottext">Options -&gt; Int
</span><a href="Language.LSP.Server.Core.html#optProgressStartDelay"><span class="hs-identifier hs-var hs-var">optProgressStartDelay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The delay before starting a progress reporting session, in microseconds</span></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optProgressUpdateDelay"><span class="annot"><span class="annottext">Options -&gt; Int
</span><a href="Language.LSP.Server.Core.html#optProgressUpdateDelay"><span class="hs-identifier hs-var hs-var">optProgressUpdateDelay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The delay between sending progress updates, in microseconds</span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679207644"><span class="annot"><span class="annottext">def :: Options
</span><a href="#local-6989586621679207644"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">Maybe TextDocumentSyncOptions
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe [CodeActionKind]
-&gt; Maybe (NonEmpty Char)
-&gt; Maybe [Text]
-&gt; Maybe ServerInfo
-&gt; Bool
-&gt; Int
-&gt; Int
-&gt; Options
</span><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">Maybe TextDocumentSyncOptions
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-307"></span><span>      </span><span class="annot"><span class="annottext">Maybe [CodeActionKind]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><span class="annottext">Maybe (NonEmpty Char)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-309"></span><span>      </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">Maybe ServerInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-311"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-comment">-- See Note [Delayed progress reporting]</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Language.LSP.Server.Core.html#defaultOptions"><span class="hs-identifier hs-type">defaultOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span>
</span><span id="line-317"></span><span id="defaultOptions"><span class="annot"><span class="annottext">defaultOptions :: Options
</span><a href="Language.LSP.Server.Core.html#defaultOptions"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Options
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- See Note [LSP configuration] for discussion of the configuration-related fields</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">{- | Contains all the callbacks to use for initialized the language server.
 it is parameterized over a config type variable representing the type for the
 specific configuration data the language server needs to use.
-}</span></span><span>
</span><span id="line-325"></span><span class="hs-keyword">data</span><span> </span><span id="ServerDefinition"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerDefinition"><span class="hs-identifier hs-var">ServerDefinition</span></a></span></span><span> </span><span id="local-6989586621679206727"><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679207647"><span class="annot"><a href="#local-6989586621679207647"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679207648"><span class="annot"><a href="#local-6989586621679207648"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-326"></span><span>  </span><span id="ServerDefinition"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerDefinition"><span class="hs-identifier hs-var">ServerDefinition</span></a></span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="defaultConfig"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; config
</span><a href="Language.LSP.Server.Core.html#defaultConfig"><span class="hs-identifier hs-var hs-var">defaultConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The default value we initialize the config variable to.</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="configSection"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#configSection"><span class="hs-identifier hs-var hs-var">configSection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-comment">-- ^ The &quot;config section&quot; that this server uses. This is used to identify the settings</span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-comment">-- that are relevant to the server.</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="parseConfig"><span class="annot"><span class="annottext">forall config.
ServerDefinition config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#parseConfig"><span class="hs-identifier hs-var hs-var">parseConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-comment">-- ^ @parseConfig oldConfig newConfigObject@ is called whenever we</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-comment">-- get updated configuration from the client.</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-comment">-- @parseConfig@ is called on the object corresponding to the server's</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- config section, it should not itself try to look for the config section.</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-comment">-- Note that the 'J.Value' may represent only a partial object in the case where we</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-comment">-- are handling a @workspace/didChangeConfiguration@ request where the client sends</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-comment">-- only the changed settings. This is also the main circumstance where the old configuration</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-comment">-- argument is useful. It is generally fine for servers to ignore this case and just</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-comment">-- assume that the 'J.Value' represents a full new config and ignore the old configuration.</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-comment">-- This will only be problematic in the case of clients which behave as above and *also*</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-comment">-- don't support @workspace/configuration@, which is discouraged.</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="onConfigChange"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#onConfigChange"><span class="hs-identifier hs-var hs-var">onConfigChange</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-comment">-- ^ This callback is called any time the configuration is updated, with</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-comment">-- the new config. Servers that want to react to config changes should provide</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-comment">-- a callback here, it is not sufficient to just add e.g. a @workspace/didChangeConfiguration@</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-comment">-- handler.</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="doInitialize"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#doInitialize"><span class="hs-identifier hs-var hs-var">doInitialize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206727"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TMessage</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method_Initialize</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TResponseError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method_Initialize</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679207648"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-comment">-- ^ Called *after* receiving the @initialize@ request and *before*</span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-comment">-- returning the response. This callback will be invoked to offer the</span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-comment">-- language server implementation the chance to create any processes or</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-comment">-- start new threads that may be necessary for the server lifecycle. It can</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- also return an error in the initialization if necessary.</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="staticHandlers"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#staticHandlers"><span class="hs-identifier hs-var hs-var">staticHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientCapabilities</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207647"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- ^ Handlers for any methods you want to statically support.</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- The handlers here cannot be unregistered during the server's lifetime</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- and will be registered statically in the initialize request.</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- The handlers provided can depend on the client capabilities, which</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-comment">-- are static across the lifetime of the server.</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="interpretHandler"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#interpretHandler"><span class="hs-identifier hs-var hs-var">interpretHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679207648"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-type">&lt;~&gt;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- ^ How to run the handlers in your own monad of choice, @m@.</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-comment">-- It is passed the result of 'doInitialize', so typically you will want</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-comment">-- to thread along the 'LanguageContextEnv' as well as any other state you</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-comment">-- need to run your monad. @m@ should most likely be built on top of</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-comment">-- 'LspT'.</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-comment">-- @</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-comment">--  ServerDefinition { ...</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-comment">--  , doInitialize = \env _req -&gt; pure $ Right env</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-comment">--  , interpretHandler = \env -&gt; Iso</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-comment">--     (runLspT env) -- how to convert from IO ~&gt; m</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">--     liftIO        -- how to convert from m ~&gt; IO</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-comment">--  }</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-comment">-- @</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="options"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; Options
</span><a href="Language.LSP.Server.Core.html#options"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Configurable options for the server's capabilities.</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><span class="hs-comment">{- | A function that a 'Handler' is passed that can be used to respond to a
 request with either an error, or the response params.
-}</span></span><span>
</span><span id="line-385"></span><span class="hs-keyword">newtype</span><span> </span><span id="ServerResponseCallback"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206794"><span class="annot"><a href="#local-6989586621679206794"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ServerResponseCallback"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TResponseError</span></span><span> </span><span class="annot"><a href="#local-6989586621679206794"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679206794"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><span class="hs-comment">{- | Return value signals if response handler was inserted successfully
 Might fail if the id was already in the map
-}</span></span><span>
</span><span id="line-391"></span><span id="local-6989586621679206733"><span id="local-6989586621679206734"><span id="local-6989586621679206735"><span class="annot"><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-type">addResponseHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206733"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206734"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="annot"><a href="#local-6989586621679206735"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-type">ServerResponseCallback</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679206735"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206734"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-392"></span><span id="addResponseHandler"><span class="annot"><span class="annottext">addResponseHandler :: forall config (f :: * -&gt; *) (m :: Method 'ServerToClient 'Request).
MonadLsp config f =&gt;
LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; f Bool
</span><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-var hs-var">addResponseHandler</span></a></span></span><span> </span><span id="local-6989586621679207665"><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207665"><span class="hs-identifier hs-var">lid</span></a></span></span><span> </span><span id="local-6989586621679207666"><span class="annot"><span class="annottext">Product
  @(Method 'ServerToClient 'Request)
  (SMethod @'ServerToClient @'Request)
  ServerResponseCallback
  m
</span><a href="#local-6989586621679207666"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar ResponseMap)
-&gt; (ResponseMap -&gt; (Bool, ResponseMap)) -&gt; f Bool
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar ResponseMap
forall config. LanguageContextState config -&gt; TVar ResponseMap
</span><a href="Language.LSP.Server.Core.html#resPendingResponses"><span class="hs-identifier hs-var">resPendingResponses</span></a></span><span> </span><span class="annot"><span class="annottext">((ResponseMap -&gt; (Bool, ResponseMap)) -&gt; f Bool)
-&gt; (ResponseMap -&gt; (Bool, ResponseMap)) -&gt; f Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679207667"><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679207667"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; ResponseMap
-&gt; Maybe ResponseMap
forall {a} (k :: a -&gt; *) (m :: a) (f :: a -&gt; *).
IxOrd @a k =&gt;
k m -&gt; f m -&gt; IxMap @a k f -&gt; Maybe (IxMap @a k f)
</span><span class="hs-identifier hs-var">insertIxMap</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207665"><span class="hs-identifier hs-var">lid</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ServerToClient 'Request)
  (SMethod @'ServerToClient @'Request)
  ServerResponseCallback
  m
</span><a href="#local-6989586621679207666"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679207667"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679207669"><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679207669"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679207669"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>      </span><span class="annot"><span class="annottext">Maybe ResponseMap
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679207667"><span class="hs-identifier hs-var">pending</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-type">sendNotification</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206751"><span class="annot"><a href="#local-6989586621679206751"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206750"><span class="annot"><a href="#local-6989586621679206750"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679206749"><span class="annot"><a href="#local-6989586621679206749"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206749"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206750"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SServerMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206751"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MessageParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679206751"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><a href="#local-6989586621679206750"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span id="sendNotification"><span class="annot"><span class="annottext">sendNotification :: forall (m :: Method 'ServerToClient 'Notification) (f :: * -&gt; *)
       config.
MonadLsp config f =&gt;
SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-var hs-var">sendNotification</span></a></span></span><span> </span><span id="local-6989586621679207674"><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679207674"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679207675"><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Notification m
</span><a href="#local-6989586621679207675"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207676"><span class="annot"><span class="annottext">msg :: TNotificationMessage @'ServerToClient m
</span><a href="#local-6989586621679207676"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m
-&gt; TNotificationMessage @'ServerToClient m
forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679207674"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Notification m
</span><a href="#local-6989586621679207675"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-406"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m -&gt; ServerNotOrReq @'Notification m
forall {t :: MessageKind} (m :: Method 'ServerToClient t).
SServerMethod @t m -&gt; ServerNotOrReq @t m
</span><span class="hs-identifier hs-var">splitServerMethod</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679207674"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-407"></span><span>        </span><span class="annot"><span class="annottext">ServerNotOrReq @'Notification m
</span><span class="hs-identifier hs-var">IsServerNot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; f ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; f ()) -&gt; FromServerMessage -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient m
</span><a href="#local-6989586621679207676"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">ServerNotOrReq @'Notification m
</span><span class="hs-identifier hs-var">IsServerEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; f ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; f ()) -&gt; FromServerMessage -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
-&gt; TMessage @'ServerToClient @'Notification m -&gt; FromServerMessage
forall (t :: MessageKind) (m :: Method 'ServerToClient t)
       (a :: Method 'ClientToServer 'Request -&gt; *).
SMethod @'ServerToClient @t m
-&gt; TMessage @'ServerToClient @t m -&gt; FromServerMessage' a
</span><span class="hs-identifier hs-var">FromServerMess</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679207674"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(TMessage @'ServerToClient @'Notification m -&gt; FromServerMessage)
-&gt; TMessage @'ServerToClient @'Notification m -&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage
  @'ServerToClient
  ('Method_CustomMethod @'ServerToClient @'Notification s)
-&gt; TCustomMessage s 'ServerToClient 'Notification
forall (s :: Symbol) (f :: MessageDirection).
TNotificationMessage @f ('Method_CustomMethod @f @'Notification s)
-&gt; TCustomMessage s f 'Notification
</span><span class="hs-identifier hs-var">NotMess</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient m
TNotificationMessage
  @'ServerToClient
  ('Method_CustomMethod @'ServerToClient @'Notification s)
</span><a href="#local-6989586621679207676"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-type">sendRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206780"><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206779"><span class="annot"><a href="#local-6989586621679206779"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679206778"><span class="annot"><a href="#local-6989586621679206778"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206778"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206779"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SServerMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MessageParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TResponseError</span></span><span> </span><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206779"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="#local-6989586621679206779"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="annot"><a href="#local-6989586621679206780"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span id="sendRequest"><span class="annot"><span class="annottext">sendRequest :: forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      (TResponseError @'ServerToClient m)
      (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var hs-var">sendRequest</span></a></span></span><span> </span><span id="local-6989586621679207718"><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679207718"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679207719"><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Request m
</span><a href="#local-6989586621679207719"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679207720"><span class="annot"><span class="annottext">Either
  (TResponseError @'ServerToClient m)
  (MessageResult @'ServerToClient @'Request m)
-&gt; f ()
</span><a href="#local-6989586621679207720"><span class="hs-identifier hs-var">resHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621679207721"><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207721"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; LspId @'ServerToClient m
forall (f :: MessageDirection) (m :: Method f 'Request).
Int32 -&gt; LspId @f m
</span><span class="hs-identifier hs-var">IdInt</span></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; LspId @'ServerToClient m)
-&gt; f Int32 -&gt; f (LspId @'ServerToClient m)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f Int32
forall config (m :: * -&gt; *). MonadLsp config m =&gt; m Int32
</span><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-var">freshLspId</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621679207724"><span class="annot"><span class="annottext">f () -&gt; IO ()
</span><a href="#local-6989586621679207724"><span class="hs-identifier hs-var">rio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f (f () -&gt; IO ())
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">askRunInIO</span></span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621679207726"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679207726"><span class="hs-identifier hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; f Bool
forall config (f :: * -&gt; *) (m :: Method 'ServerToClient 'Request).
MonadLsp config f =&gt;
LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; f Bool
</span><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-var">addResponseHandler</span></a></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207721"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SServerMethod @'Request m
-&gt; ServerResponseCallback m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679207718"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either
   (TResponseError @'ServerToClient m)
   (MessageResult @'ServerToClient @'Request m)
 -&gt; IO ())
-&gt; ServerResponseCallback m
forall (m :: Method 'ServerToClient 'Request).
(Either
   (TResponseError @'ServerToClient m)
   (MessageResult @'ServerToClient @'Request m)
 -&gt; IO ())
-&gt; ServerResponseCallback m
</span><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f () -&gt; IO ()
</span><a href="#local-6989586621679207724"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; IO ())
-&gt; (Either
      (TResponseError @'ServerToClient m)
      (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; Either
     (TResponseError @'ServerToClient m)
     (MessageResult @'ServerToClient @'Request m)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either
  (TResponseError @'ServerToClient m)
  (MessageResult @'ServerToClient @'Request m)
-&gt; f ()
</span><a href="#local-6989586621679207720"><span class="hs-identifier hs-var">resHandler</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679207726"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LSP: could not send FromServer request as id is reused&quot;</span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207730"><span class="annot"><span class="annottext">msg :: TRequestMessage @'ServerToClient m
</span><a href="#local-6989586621679207730"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; LspId @'ServerToClient m
-&gt; SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; TRequestMessage @'ServerToClient m
forall (f :: MessageDirection) (m :: Method f 'Request).
Text
-&gt; LspId @f m
-&gt; SMethod @f @'Request m
-&gt; MessageParams @f @'Request m
-&gt; TRequestMessage @f m
</span><span class="hs-identifier hs-var">TRequestMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207721"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679207718"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Request m
</span><a href="#local-6989586621679207719"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m -&gt; ServerNotOrReq @'Request m
forall {t :: MessageKind} (m :: Method 'ServerToClient t).
SServerMethod @t m -&gt; ServerNotOrReq @t m
</span><span class="hs-identifier hs-var">splitServerMethod</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679207718"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">ServerNotOrReq @'Request m
</span><span class="hs-identifier hs-var">IsServerReq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; f ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; f ()) -&gt; FromServerMessage -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ServerToClient m -&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Request).
((TMessage @'ServerToClient @'Request m :: *)
 ~ (TRequestMessage @'ServerToClient m :: *)) =&gt;
TRequestMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerReq</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ServerToClient m
</span><a href="#local-6989586621679207730"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">ServerNotOrReq @'Request m
</span><span class="hs-identifier hs-var">IsServerEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; f ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; f ()) -&gt; FromServerMessage -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
-&gt; TMessage @'ServerToClient @'Request m -&gt; FromServerMessage
forall (t :: MessageKind) (m :: Method 'ServerToClient t)
       (a :: Method 'ClientToServer 'Request -&gt; *).
SMethod @'ServerToClient @t m
-&gt; TMessage @'ServerToClient @t m -&gt; FromServerMessage' a
</span><span class="hs-identifier hs-var">FromServerMess</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679207718"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(TMessage @'ServerToClient @'Request m -&gt; FromServerMessage)
-&gt; TMessage @'ServerToClient @'Request m -&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage
  @'ServerToClient
  ('Method_CustomMethod @'ServerToClient @'Request s)
-&gt; TCustomMessage s 'ServerToClient 'Request
forall (s :: Symbol) (f :: MessageDirection).
TRequestMessage @f ('Method_CustomMethod @f @'Request s)
-&gt; TCustomMessage s f 'Request
</span><span class="hs-identifier hs-var">ReqMess</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ServerToClient m
TRequestMessage
  @'ServerToClient
  ('Method_CustomMethod @'ServerToClient @'Request s)
</span><a href="#local-6989586621679207730"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">LspId @'ServerToClient m -&gt; f (LspId @'ServerToClient m)
forall a. a -&gt; f a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679207721"><span class="hs-identifier hs-var">reqId</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><span class="hs-comment">-- | Return the 'VirtualFile' associated with a given 'NormalizedUri', if there is one.</span></span><span>
</span><span id="line-432"></span><span id="local-6989586621679206804"><span id="local-6989586621679206805"><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-type">getVirtualFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206804"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VirtualFile"><span class="hs-identifier hs-type">VirtualFile</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-433"></span><span id="getVirtualFile"><span class="annot"><span class="annottext">getVirtualFile :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
NormalizedUri -&gt; m (Maybe VirtualFile)
</span><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-var hs-var">getVirtualFile</span></a></span></span><span> </span><span id="local-6989586621679207769"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679207769"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621679207770"><span class="annot"><span class="annottext">VFS
</span><a href="#local-6989586621679207770"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">(VFSData -&gt; VFS) -&gt; m VFSData -&gt; m VFS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar VFSData) -&gt; m VFSData
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar VFSData
forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="annottext">Maybe VirtualFile -&gt; m (Maybe VirtualFile)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe VirtualFile -&gt; m (Maybe VirtualFile))
-&gt; Maybe VirtualFile -&gt; m (Maybe VirtualFile)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFS
</span><a href="#local-6989586621679207770"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="annot"><span class="annottext">VFS
-&gt; Getting (Maybe VirtualFile) VFS (Maybe VirtualFile)
-&gt; Maybe VirtualFile
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(Map NormalizedUri VirtualFile
 -&gt; Const @(*) (Maybe VirtualFile) (Map NormalizedUri VirtualFile))
-&gt; VFS -&gt; Const @(*) (Maybe VirtualFile) VFS
forall s a. HasVfsMap s a =&gt; Lens' s a
Lens' VFS (Map NormalizedUri VirtualFile)
</span><a href="Language.LSP.VFS.html#vfsMap"><span class="hs-identifier hs-var">vfsMap</span></a></span><span> </span><span class="annot"><span class="annottext">((Map NormalizedUri VirtualFile
  -&gt; Const @(*) (Maybe VirtualFile) (Map NormalizedUri VirtualFile))
 -&gt; VFS -&gt; Const @(*) (Maybe VirtualFile) VFS)
-&gt; ((Maybe VirtualFile
     -&gt; Const @(*) (Maybe VirtualFile) (Maybe VirtualFile))
    -&gt; Map NormalizedUri VirtualFile
    -&gt; Const @(*) (Maybe VirtualFile) (Map NormalizedUri VirtualFile))
-&gt; Getting (Maybe VirtualFile) VFS (Maybe VirtualFile)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NormalizedUri VirtualFile)
-&gt; Lens'
     (Map NormalizedUri VirtualFile)
     (Maybe (IxValue (Map NormalizedUri VirtualFile)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NormalizedUri VirtualFile)
NormalizedUri
</span><a href="#local-6989586621679207769"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-436"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-pragma hs-type">getVirtualFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span id="local-6989586621679206823"><span id="local-6989586621679206824"><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-identifier hs-type">getVirtualFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206823"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span></span></span><span>
</span><span id="line-439"></span><span id="getVirtualFiles"><span class="annot"><span class="annottext">getVirtualFiles :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m VFS
</span><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-identifier hs-var hs-var">getVirtualFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">(VFSData -&gt; VFS) -&gt; m VFSData -&gt; m VFS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar VFSData) -&gt; m VFSData
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar VFSData
forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-440"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-pragma hs-type">getVirtualFiles</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><span class="hs-comment">-- | Take an atomic snapshot of the current state of the virtual file system.</span></span><span>
</span><span id="line-443"></span><span id="local-6989586621679206827"><span class="annot"><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-identifier hs-type">snapshotVirtualFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206827"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span></span><span>
</span><span id="line-444"></span><span id="snapshotVirtualFiles"><span class="annot"><span class="annottext">snapshotVirtualFiles :: forall c. LanguageContextEnv c -&gt; STM VFS
</span><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-identifier hs-var hs-var">snapshotVirtualFiles</span></a></span></span><span> </span><span id="local-6989586621679207784"><span class="annot"><span class="annottext">LanguageContextEnv c
</span><a href="#local-6989586621679207784"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">(VFSData -&gt; VFS) -&gt; STM VFSData -&gt; STM VFS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar VFSData -&gt; STM VFSData
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LanguageContextState c -&gt; TVar VFSData
forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState c -&gt; TVar VFSData)
-&gt; LanguageContextState c -&gt; TVar VFSData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv c -&gt; LanguageContextState c
forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv c
</span><a href="#local-6989586621679207784"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-pragma hs-type">snapshotVirtualFiles</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="annot"><span class="hs-comment">{- | Dump the current text for a given VFS file to a file
 in the given directory and return the path to the file.
-}</span></span><span>
</span><span id="line-450"></span><span id="local-6989586621679206830"><span id="local-6989586621679206831"><span class="annot"><a href="Language.LSP.Server.Core.html#persistVirtualFile"><span class="hs-identifier hs-type">persistVirtualFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206830"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679206831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VfsLog"><span class="hs-identifier hs-type">VfsLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-451"></span><span id="persistVirtualFile"><span class="annot"><span class="annottext">persistVirtualFile :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
LogAction m (WithSeverity VfsLog)
-&gt; String -&gt; NormalizedUri -&gt; m (Maybe String)
</span><a href="Language.LSP.Server.Core.html#persistVirtualFile"><span class="hs-identifier hs-var hs-var">persistVirtualFile</span></a></span></span><span> </span><span id="local-6989586621679207802"><span class="annot"><span class="annottext">LogAction m (WithSeverity VfsLog)
</span><a href="#local-6989586621679207802"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679207803"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207803"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621679207804"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679207804"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="annottext">m (m (Maybe String)) -&gt; m (Maybe String)
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(m (m (Maybe String)) -&gt; m (Maybe String))
-&gt; m (m (Maybe String)) -&gt; m (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar VFSData)
-&gt; (VFSData -&gt; (m (Maybe String), VFSData)) -&gt; m (m (Maybe String))
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar VFSData
forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span> </span><span class="annot"><span class="annottext">((VFSData -&gt; (m (Maybe String), VFSData)) -&gt; m (m (Maybe String)))
-&gt; (VFSData -&gt; (m (Maybe String), VFSData)) -&gt; m (m (Maybe String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679207805"><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity VfsLog)
-&gt; String -&gt; VFS -&gt; NormalizedUri -&gt; Maybe (String, m ())
forall (m :: * -&gt; *).
MonadIO m =&gt;
LogAction m (WithSeverity VfsLog)
-&gt; String -&gt; VFS -&gt; NormalizedUri -&gt; Maybe (String, m ())
</span><a href="Language.LSP.VFS.html#persistFileVFS"><span class="hs-identifier hs-var">persistFileVFS</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity VfsLog)
</span><a href="#local-6989586621679207802"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207803"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679207804"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><span class="annottext">Maybe (String, m ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; m (Maybe String)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679207807"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207807"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679207808"><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679207808"><span class="hs-identifier hs-var">write</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679207809"><span class="annot"><span class="annottext">revMap :: Map String String
</span><a href="#local-6989586621679207809"><span class="hs-identifier hs-var hs-var">revMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Uri -&gt; Maybe String
</span><span class="hs-identifier hs-var">uriToFilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NormalizedUri -&gt; Uri
</span><span class="hs-identifier hs-var">fromNormalizedUri</span></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679207804"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-457"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679207812"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207812"><span class="hs-identifier hs-var">uri_fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Map String String -&gt; Map String String
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207807"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207812"><span class="hs-identifier hs-var">uri_fp</span></a></span><span> </span><span class="annot"><span class="annottext">(Map String String -&gt; Map String String)
-&gt; Map String String -&gt; Map String String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-458"></span><span>              </span><span class="hs-comment">-- TODO: Does the VFS make sense for URIs which are not files?</span><span>
</span><span id="line-459"></span><span>              </span><span class="hs-comment">-- The reverse map should perhaps be (FilePath -&gt; URI)</span><span>
</span><span id="line-460"></span><span>              </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-461"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679207814"><span class="annot"><span class="annottext">vfs' :: VFSData
</span><a href="#local-6989586621679207814"><span class="hs-identifier hs-var hs-var">vfs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207805"><span class="hs-identifier hs-var">vfs</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679207809"><span class="hs-identifier hs-type">revMap</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-462"></span><span>            </span><span id="local-6989586621679207815"><span class="annot"><span class="annottext">act :: m (Maybe String)
</span><a href="#local-6989586621679207815"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>              </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679207808"><span class="hs-identifier hs-var">write</span></a></span><span>
</span><span id="line-464"></span><span>              </span><span class="annot"><span class="annottext">Maybe String -&gt; m (Maybe String)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207807"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Maybe String)
</span><a href="#local-6989586621679207815"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207814"><span class="hs-identifier hs-var">vfs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><span class="hs-comment">-- | Given a text document identifier, annotate it with the latest version.</span></span><span>
</span><span id="line-468"></span><span id="local-6989586621679206843"><span id="local-6989586621679206844"><span class="annot"><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-identifier hs-type">getVersionedTextDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206843"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206844"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TextDocumentIdentifier</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206844"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VersionedTextDocumentIdentifier</span></span></span></span><span>
</span><span id="line-469"></span><span id="getVersionedTextDoc"><span class="annot"><span class="annottext">getVersionedTextDoc :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
TextDocumentIdentifier -&gt; m VersionedTextDocumentIdentifier
</span><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-identifier hs-var hs-var">getVersionedTextDoc</span></a></span></span><span> </span><span id="local-6989586621679207829"><span class="annot"><span class="annottext">TextDocumentIdentifier
</span><a href="#local-6989586621679207829"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207830"><span class="annot"><span class="annottext">uri :: Uri
</span><a href="#local-6989586621679207830"><span class="hs-identifier hs-var hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TextDocumentIdentifier
</span><a href="#local-6989586621679207829"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">TextDocumentIdentifier
-&gt; Getting Uri TextDocumentIdentifier Uri -&gt; Uri
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Uri TextDocumentIdentifier Uri
forall s a. HasUri s a =&gt; Lens' s a
Lens' TextDocumentIdentifier Uri
</span><span class="hs-identifier hs-var">L.uri</span></span><span>
</span><span id="line-471"></span><span>  </span><span id="local-6989586621679207832"><span class="annot"><span class="annottext">Maybe VirtualFile
</span><a href="#local-6989586621679207832"><span class="hs-identifier hs-var">mvf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NormalizedUri -&gt; m (Maybe VirtualFile)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
NormalizedUri -&gt; m (Maybe VirtualFile)
</span><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-var">getVirtualFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uri -&gt; NormalizedUri
</span><span class="hs-identifier hs-var">toNormalizedUri</span></span><span> </span><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621679207830"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207834"><span class="annot"><span class="annottext">ver :: Int32
</span><a href="#local-6989586621679207834"><span class="hs-identifier hs-var hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe VirtualFile
</span><a href="#local-6989586621679207832"><span class="hs-identifier hs-var">mvf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.VFS.html#VirtualFile"><span class="hs-identifier hs-type">VirtualFile</span></a></span><span> </span><span id="local-6989586621679207835"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207835"><span class="hs-identifier hs-var">lspver</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Rope
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207835"><span class="hs-identifier hs-var">lspver</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">Maybe VirtualFile
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="annottext">VersionedTextDocumentIdentifier
-&gt; m VersionedTextDocumentIdentifier
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uri -&gt; Int32 -&gt; VersionedTextDocumentIdentifier
</span><span class="hs-identifier hs-var">VersionedTextDocumentIdentifier</span></span><span> </span><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621679207830"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207834"><span class="hs-identifier hs-var">ver</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-pragma hs-type">getVersionedTextDoc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- TODO: should this function return a URI?</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><span class="hs-comment">{- | If the contents of a VFS has been dumped to a temporary file, map
 the temporary file name back to the original one.
-}</span></span><span>
</span><span id="line-483"></span><span id="local-6989586621679206853"><span id="local-6989586621679206854"><span class="annot"><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-identifier hs-type">reverseFileMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206853"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206854"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206854"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-484"></span><span id="reverseFileMap"><span class="annot"><span class="annottext">reverseFileMap :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m ShowS
</span><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-identifier hs-var hs-var">reverseFileMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>  </span><span id="local-6989586621679207847"><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207847"><span class="hs-identifier hs-var">vfs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar VFSData) -&gt; m VFSData
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar VFSData
forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207848"><span class="annot"><span class="annottext">f :: ShowS
</span><a href="#local-6989586621679207848"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679207849"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207849"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Map String String -&gt; String
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207849"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679207849"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">(Map String String -&gt; String) -&gt; Map String String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679207847"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="annot"><span class="annottext">ShowS -&gt; m ShowS
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679207848"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-488"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-pragma hs-type">reverseFileMap</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span id="local-6989586621679206766"><span id="local-6989586621679206767"><span class="annot"><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-type">sendToClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206766"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromServerMessage</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-493"></span><span id="sendToClient"><span class="annot"><span class="annottext">sendToClient :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var hs-var">sendToClient</span></a></span></span><span> </span><span id="local-6989586621679207861"><span class="annot"><span class="annottext">FromServerMessage
</span><a href="#local-6989586621679207861"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>  </span><span id="local-6989586621679207862"><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679207862"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resSendMessage"><span class="hs-identifier hs-var">resSendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ())
-&gt; m (LanguageContextEnv config) -&gt; m (FromServerMessage -&gt; IO ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679207862"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FromServerMessage
</span><a href="#local-6989586621679207861"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-496"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-pragma hs-type">sendToClient</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span id="local-6989586621679206786"><span id="local-6989586621679206787"><span class="annot"><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-type">freshLspId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206786"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206787"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206787"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span></span></span><span>
</span><span id="line-501"></span><span id="freshLspId"><span class="annot"><span class="annottext">freshLspId :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m Int32
</span><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-var hs-var">freshLspId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-502"></span><span>  </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar Int32)
-&gt; (Int32 -&gt; (Int32, Int32)) -&gt; m Int32
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar Int32
forall config. LanguageContextState config -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#resLspId"><span class="hs-identifier hs-var">resLspId</span></a></span><span> </span><span class="annot"><span class="annottext">((Int32 -&gt; (Int32, Int32)) -&gt; m Int32)
-&gt; (Int32 -&gt; (Int32, Int32)) -&gt; m Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679207867"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207867"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679207868"><span class="annot"><span class="annottext">next :: Int32
</span><a href="#local-6989586621679207868"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207867"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207867"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679207868"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-pragma hs-type">freshLspId</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="annot"><span class="hs-comment">{- | The current configuration from the client as set via the @initialize@ and
 @workspace/didChangeConfiguration@ requests, as well as by calls to
 'setConfig'.
-}</span></span><span>
</span><span id="line-512"></span><span id="local-6989586621679206864"><span id="local-6989586621679206865"><span class="annot"><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-identifier hs-type">getConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206864"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206865"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206865"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206864"><span class="hs-identifier hs-type">config</span></a></span></span></span><span>
</span><span id="line-513"></span><span id="getConfig"><span class="annot"><span class="annottext">getConfig :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m config
</span><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-identifier hs-var hs-var">getConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar config) -&gt; m config
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar config
forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span>
</span><span id="line-514"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-pragma hs-type">getConfig</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span id="local-6989586621679206868"><span id="local-6989586621679206869"><span class="annot"><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-identifier hs-type">setConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206868"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206868"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-517"></span><span id="setConfig"><span class="annot"><span class="annottext">setConfig :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; config -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-identifier hs-var hs-var">setConfig</span></a></span></span><span> </span><span id="local-6989586621679207876"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679207876"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar config)
-&gt; (config -&gt; ((), config)) -&gt; m ()
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar config
forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((), config) -&gt; config -&gt; ((), config)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679207876"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-pragma hs-type">setConfig</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span id="local-6989586621679206874"><span id="local-6989586621679206875"><span class="annot"><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-type">getClientCapabilities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206874"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ClientCapabilities</span></span></span></span><span>
</span><span id="line-521"></span><span id="getClientCapabilities"><span class="annot"><span class="annottext">getClientCapabilities :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var hs-var">getClientCapabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; ClientCapabilities
forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; ClientCapabilities)
-&gt; m (LanguageContextEnv config) -&gt; m ClientCapabilities
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-522"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-pragma hs-type">getClientCapabilities</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span id="local-6989586621679206878"><span id="local-6989586621679206879"><span class="annot"><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-identifier hs-type">getRootPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206878"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206879"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206879"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-525"></span><span id="getRootPath"><span class="annot"><span class="annottext">getRootPath :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m (Maybe String)
</span><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-identifier hs-var hs-var">getRootPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; Maybe String
forall config. LanguageContextEnv config -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#resRootPath"><span class="hs-identifier hs-var">resRootPath</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; Maybe String)
-&gt; m (LanguageContextEnv config) -&gt; m (Maybe String)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-526"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-pragma hs-type">getRootPath</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="annot"><span class="hs-comment">-- | The current workspace folders, if the client supports workspace folders.</span></span><span>
</span><span id="line-529"></span><span id="local-6989586621679206882"><span id="local-6989586621679206883"><span class="annot"><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-identifier hs-type">getWorkspaceFolders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206882"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206883"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206883"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">WorkspaceFolder</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-530"></span><span id="getWorkspaceFolders"><span class="annot"><span class="annottext">getWorkspaceFolders :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (Maybe [WorkspaceFolder])
</span><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-identifier hs-var hs-var">getWorkspaceFolders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-531"></span><span>  </span><span id="local-6989586621679207922"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679207922"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ClientCapabilities
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var">getClientCapabilities</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207923"><span class="annot"><span class="annottext">clientSupportsWfs :: Bool
</span><a href="#local-6989586621679207923"><span class="hs-identifier hs-var hs-var">clientSupportsWfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679207922"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
-&gt; Getting (First Bool) ClientCapabilities Bool -&gt; Maybe Bool
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">(Maybe WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; ClientCapabilities -&gt; Const @(*) (First Bool) ClientCapabilities
forall s a. HasWorkspace s a =&gt; Lens' s a
Lens' ClientCapabilities (Maybe WorkspaceClientCapabilities)
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">((Maybe WorkspaceClientCapabilities
  -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
 -&gt; ClientCapabilities
 -&gt; Const @(*) (First Bool) ClientCapabilities)
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; Maybe WorkspaceClientCapabilities
    -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; Getting (First Bool) ClientCapabilities Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; Maybe WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities)
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((WorkspaceClientCapabilities
  -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
 -&gt; Maybe WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; WorkspaceClientCapabilities
    -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; (Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; Maybe WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
-&gt; WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) WorkspaceClientCapabilities
forall s a. HasWorkspaceFolders s a =&gt; Lens' s a
Lens' WorkspaceClientCapabilities (Maybe Bool)
</span><span class="hs-identifier hs-var">L.workspaceFolders</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
 -&gt; WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
-&gt; (Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) WorkspaceClientCapabilities
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool)
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679207923"><span class="hs-identifier hs-var">clientSupportsWfs</span></a></span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[WorkspaceFolder] -&gt; Maybe [WorkspaceFolder]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([WorkspaceFolder] -&gt; Maybe [WorkspaceFolder])
-&gt; m [WorkspaceFolder] -&gt; m (Maybe [WorkspaceFolder])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar [WorkspaceFolder])
-&gt; m [WorkspaceFolder]
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar [WorkspaceFolder]
forall config.
LanguageContextState config -&gt; TVar [WorkspaceFolder]
</span><a href="Language.LSP.Server.Core.html#resWorkspaceFolders"><span class="hs-identifier hs-var">resWorkspaceFolders</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [WorkspaceFolder] -&gt; m (Maybe [WorkspaceFolder])
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe [WorkspaceFolder]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-536"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-pragma hs-type">getWorkspaceFolders</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><span class="hs-comment">{- | Sends a @client/registerCapability@ request and dynamically registers
 a 'Method' with a 'Handler'. Returns 'Nothing' if the client does not
 support dynamic registration for the specified method, otherwise a
 'RegistrationToken' which can be used to unregister it later.
-}</span></span><span>
</span><span id="line-543"></span><span class="annot"><a href="Language.LSP.Server.Core.html#registerCapability"><span class="hs-identifier hs-type">registerCapability</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679206906"><span class="annot"><a href="#local-6989586621679206906"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679206904"><span class="annot"><a href="#local-6989586621679206904"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206907"><span class="annot"><a href="#local-6989586621679206907"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679206904"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206905"><span class="annot"><a href="#local-6989586621679206905"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206905"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206906"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679206906"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SClientMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RegistrationOptions</span></span><span> </span><span class="annot"><a href="#local-6989586621679206907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206906"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><a href="#local-6989586621679206906"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span id="registerCapability"><span class="annot"><span class="annottext">registerCapability :: forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t) config.
MonadLsp config f =&gt;
LogAction f (WithSeverity LspCoreLog)
-&gt; SClientMethod @t m
-&gt; RegistrationOptions @'ClientToServer @t m
-&gt; Handler @'ClientToServer @t f m
-&gt; f (Maybe (RegistrationToken @t m))
</span><a href="Language.LSP.Server.Core.html#registerCapability"><span class="hs-identifier hs-var hs-var">registerCapability</span></a></span></span><span> </span><span id="local-6989586621679207945"><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679207945"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679207946"><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679207947"><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679207947"><span class="hs-identifier hs-var">regOpts</span></a></span></span><span> </span><span id="local-6989586621679207948"><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
</span><a href="#local-6989586621679207948"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>  </span><span id="local-6989586621679207949"><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679207949"><span class="hs-identifier hs-var">handlers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; Handlers IO
forall config. LanguageContextEnv config -&gt; Handlers IO
</span><a href="Language.LSP.Server.Core.html#resHandlers"><span class="hs-identifier hs-var">resHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; Handlers IO)
-&gt; f (LanguageContextEnv config) -&gt; f (Handlers IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207950"><span class="annot"><span class="annottext">alreadyStaticallyRegistered :: Bool
</span><a href="#local-6989586621679207950"><span class="hs-identifier hs-var hs-var">alreadyStaticallyRegistered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m -&gt; ClientNotOrReq @t m
forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler IO 'Notification)
-&gt; Bool
forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; Bool
</span><span class="hs-identifier hs-var">SMethodMap.member</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">(SMethodMap
   @'ClientToServer
   @'Notification
   (ClientMessageHandler IO 'Notification)
 -&gt; Bool)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler IO 'Notification)
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handlers IO
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler IO 'Notification)
forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
</span><a href="Language.LSP.Server.Core.html#notHandlers"><span class="hs-identifier hs-var">notHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679207949"><span class="hs-identifier hs-var">handlers</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler IO 'Request)
-&gt; Bool
forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; Bool
</span><span class="hs-identifier hs-var">SMethodMap.member</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">(SMethodMap
   @'ClientToServer @'Request (ClientMessageHandler IO 'Request)
 -&gt; Bool)
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler IO 'Request)
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handlers IO
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler IO 'Request)
forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="Language.LSP.Server.Core.html#reqHandlers"><span class="hs-identifier hs-var">reqHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679207949"><span class="hs-identifier hs-var">handlers</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot register capability for custom methods&quot;</span></span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; f (Maybe (RegistrationToken @t m))
</span><a href="#local-6989586621679207968"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679207950"><span class="hs-identifier hs-var">alreadyStaticallyRegistered</span></a></span><span>
</span><span id="line-558"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-comment">-- If the server has already registered statically, don't dynamically register</span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-comment">-- as per the spec</span><span>
</span><span id="line-561"></span><span>  </span><span id="local-6989586621679207968"><span class="annot"><span class="annottext">go :: Bool -&gt; f (Maybe (RegistrationToken @t m))
</span><a href="#local-6989586621679207968"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><a href="#local-6989586621679207968"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621679207969"><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679207969"><span class="hs-identifier hs-var">rio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f (UnliftIO f)
forall (m :: * -&gt; *). MonadUnliftIO m =&gt; m (UnliftIO m)
</span><span class="hs-identifier hs-var">askUnliftIO</span></span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621679207971"><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
</span><a href="#local-6989586621679207971"><span class="hs-identifier hs-var">mtoken</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
-&gt; SClientMethod @t m
-&gt; RegistrationOptions @'ClientToServer @t m
-&gt; f (Maybe (RegistrationToken @t m))
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t) config.
MonadLsp config f =&gt;
LogAction f (WithSeverity LspCoreLog)
-&gt; SClientMethod @t m
-&gt; RegistrationOptions @'ClientToServer @t m
-&gt; f (Maybe (RegistrationToken @t m))
</span><a href="Language.LSP.Server.Core.html#trySendRegistration"><span class="hs-identifier hs-var">trySendRegistration</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679207945"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679207947"><span class="hs-identifier hs-var">regOpts</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
</span><a href="#local-6989586621679207971"><span class="hs-identifier hs-var">mtoken</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679207973"><span class="annot"><span class="annottext">token :: RegistrationToken @t m
</span><a href="#local-6989586621679207973"><span class="hs-identifier hs-var">token</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679207974"><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679207974"><span class="hs-identifier hs-var">regId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m -&gt; ClientNotOrReq @t m
forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-568"></span><span>          </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config
 -&gt; TVar (RegistrationMap 'Notification))
-&gt; (RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
-&gt; f ()
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var">resRegistrationsNot</span></a></span><span> </span><span class="annot"><span class="annottext">((RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
 -&gt; f ())
-&gt; (RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
-&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679207980"><span class="annot"><span class="annottext">RegistrationMap 'Notification
</span><a href="#local-6989586621679207980"><span class="hs-identifier hs-var">oldRegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207981"><span class="annot"><span class="annottext">pair :: Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679207981"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
-&gt; ClientMessageHandler IO t m
-&gt; Product
     @(Method 'ClientToServer t)
     (RegistrationId @t)
     (ClientMessageHandler IO t)
     m
forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679207974"><span class="hs-identifier hs-var">regId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @t IO m -&gt; ClientMessageHandler IO t m
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnliftIO f -&gt; forall a. f a -&gt; IO a
forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679207969"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; IO ())
-&gt; (TNotificationMessage @'ClientToServer m -&gt; f ())
-&gt; TNotificationMessage @'ClientToServer m
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
TNotificationMessage @'ClientToServer m -&gt; f ()
</span><a href="#local-6989586621679207948"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
-&gt; Product
     @(Method 'ClientToServer 'Notification)
     (RegistrationId @'Notification)
     (ClientMessageHandler IO 'Notification)
     m
-&gt; RegistrationMap 'Notification
-&gt; RegistrationMap 'Notification
forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.insert</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
SMethod @'ClientToServer @'Notification m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
Product
  @(Method 'ClientToServer 'Notification)
  (RegistrationId @'Notification)
  (ClientMessageHandler IO 'Notification)
  m
</span><a href="#local-6989586621679207981"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationMap 'Notification
</span><a href="#local-6989586621679207980"><span class="hs-identifier hs-var">oldRegs</span></a></span><span>
</span><span id="line-571"></span><span>          </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar (RegistrationMap 'Request))
-&gt; (RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ()
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var">resRegistrationsReq</span></a></span><span> </span><span class="annot"><span class="annottext">((RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ())
-&gt; (RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679207991"><span class="annot"><span class="annottext">RegistrationMap 'Request
</span><a href="#local-6989586621679207991"><span class="hs-identifier hs-var">oldRegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-572"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679207992"><span class="annot"><span class="annottext">pair :: Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679207992"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
-&gt; ClientMessageHandler IO t m
-&gt; Product
     @(Method 'ClientToServer t)
     (RegistrationId @t)
     (ClientMessageHandler IO t)
     m
forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679207974"><span class="hs-identifier hs-var">regId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @t IO m -&gt; ClientMessageHandler IO t m
forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679207993"><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer m
</span><a href="#local-6989586621679207993"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679207994"><span class="annot"><span class="annottext">Either
  (TResponseError @'ClientToServer m)
  (MessageResult @'ClientToServer @'Request m)
-&gt; IO ()
</span><a href="#local-6989586621679207994"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnliftIO f -&gt; forall a. f a -&gt; IO a
forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679207969"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; IO ()) -&gt; f () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
TRequestMessage @'ClientToServer m
-&gt; (Either
      (TResponseError @'ClientToServer m)
      (MessageResult @'ClientToServer @'Request m)
    -&gt; f ())
-&gt; f ()
</span><a href="#local-6989586621679207948"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer m
</span><a href="#local-6989586621679207993"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; f ()
forall a. IO a -&gt; f a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; f ())
-&gt; (Either
      (TResponseError @'ClientToServer m)
      (MessageResult @'ClientToServer @'Request m)
    -&gt; IO ())
-&gt; Either
     (TResponseError @'ClientToServer m)
     (MessageResult @'ClientToServer @'Request m)
-&gt; f ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either
  (TResponseError @'ClientToServer m)
  (MessageResult @'ClientToServer @'Request m)
-&gt; IO ()
</span><a href="#local-6989586621679207994"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
-&gt; Product
     @(Method 'ClientToServer 'Request)
     (RegistrationId @'Request)
     (ClientMessageHandler IO 'Request)
     m
-&gt; RegistrationMap 'Request
-&gt; RegistrationMap 'Request
forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.insert</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
SMethod @'ClientToServer @'Request m
</span><a href="#local-6989586621679207946"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
Product
  @(Method 'ClientToServer 'Request)
  (RegistrationId @'Request)
  (ClientMessageHandler IO 'Request)
  m
</span><a href="#local-6989586621679207992"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationMap 'Request
</span><a href="#local-6989586621679207991"><span class="hs-identifier hs-var">oldRegs</span></a></span><span>
</span><span id="line-574"></span><span>          </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot register capability for custom methods&quot;</span></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>        </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (RegistrationToken @t m)
 -&gt; f (Maybe (RegistrationToken @t m)))
-&gt; Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RegistrationToken @t m -&gt; Maybe (RegistrationToken @t m)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RegistrationToken @t m
</span><a href="#local-6989586621679207973"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><a href="Language.LSP.Server.Core.html#trySendRegistration"><span class="hs-identifier hs-type">trySendRegistration</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679206932"><span class="annot"><a href="#local-6989586621679206932"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679206930"><span class="annot"><a href="#local-6989586621679206930"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679206933"><span class="annot"><a href="#local-6989586621679206933"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679206930"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679206931"><span class="annot"><a href="#local-6989586621679206931"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206931"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206932"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679206932"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SClientMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679206933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RegistrationOptions</span></span><span> </span><span class="annot"><a href="#local-6989586621679206933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><a href="#local-6989586621679206932"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206933"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span id="trySendRegistration"><span class="annot"><span class="annottext">trySendRegistration :: forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t) config.
MonadLsp config f =&gt;
LogAction f (WithSeverity LspCoreLog)
-&gt; SClientMethod @t m
-&gt; RegistrationOptions @'ClientToServer @t m
-&gt; f (Maybe (RegistrationToken @t m))
</span><a href="Language.LSP.Server.Core.html#trySendRegistration"><span class="hs-identifier hs-var hs-var">trySendRegistration</span></a></span></span><span> </span><span id="local-6989586621679208018"><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208018"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679208019"><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679208019"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679208020"><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679208020"><span class="hs-identifier hs-var">regOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>  </span><span id="local-6989586621679208021"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679208021"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; ClientCapabilities
forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; ClientCapabilities)
-&gt; f (LanguageContextEnv config) -&gt; f ClientCapabilities
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-comment">-- First, check to see if the client supports dynamic registration on this method</span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m -&gt; ClientCapabilities -&gt; Bool
forall {f :: MessageDirection} {t :: MessageKind}
       (m :: Method f t).
SMethod @f @t m -&gt; ClientCapabilities -&gt; Bool
</span><span class="hs-identifier hs-var">dynamicRegistrationSupported</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679208019"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679208021"><span class="hs-identifier hs-var">clientCaps</span></a></span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>      </span><span id="local-6989586621679208023"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208023"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (Int32 -&gt; String) -&gt; Int32 -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; Text) -&gt; f Int32 -&gt; f Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f Int32
forall config (m :: * -&gt; *). MonadLsp config m =&gt; m Int32
</span><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-var">freshLspId</span></a></span><span>
</span><span id="line-592"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679208026"><span class="annot"><span class="annottext">registration :: TRegistration @t m
</span><a href="#local-6989586621679208026"><span class="hs-identifier hs-var hs-var">registration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; SClientMethod @t m
-&gt; Maybe (RegistrationOptions @'ClientToServer @t m)
-&gt; TRegistration @t m
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text
-&gt; SClientMethod @t m
-&gt; Maybe (RegistrationOptions @'ClientToServer @t m)
-&gt; TRegistration @t m
</span><span class="hs-identifier hs-var">L.TRegistration</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208023"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679208019"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
-&gt; Maybe (RegistrationOptions @'ClientToServer @t m)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679208020"><span class="hs-identifier hs-var">regOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>          </span><span id="local-6989586621679208028"><span class="annot"><span class="annottext">params :: RegistrationParams
</span><a href="#local-6989586621679208028"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Registration] -&gt; RegistrationParams
</span><span class="hs-identifier hs-var">L.RegistrationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TRegistration @t m -&gt; Registration
forall {t :: MessageKind} (m :: Method 'ClientToServer t).
TRegistration @t m -&gt; Registration
</span><span class="hs-identifier hs-var">toUntypedRegistration</span></span><span> </span><span class="annot"><span class="annottext">TRegistration @t m
</span><a href="#local-6989586621679208026"><span class="hs-identifier hs-var">registration</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span>          </span><span id="local-6989586621679208031"><span class="annot"><span class="annottext">regId :: RegistrationId @t m
</span><a href="#local-6989586621679208031"><span class="hs-identifier hs-var hs-var">regId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RegistrationId @t m
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text -&gt; RegistrationId @t m
</span><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208023"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>      </span><span class="hs-comment">-- TODO: handle the scenario where this returns an error</span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><span class="annottext">LspId @'ServerToClient 'Method_ClientRegisterCapability
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_ClientRegisterCapability
-&gt; MessageParams
     @'ServerToClient @'Request 'Method_ClientRegisterCapability
-&gt; (Either
      (TResponseError @'ServerToClient 'Method_ClientRegisterCapability)
      (MessageResult
         @'ServerToClient @'Request 'Method_ClientRegisterCapability)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient 'Method_ClientRegisterCapability)
forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      (TResponseError @'ServerToClient m)
      (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_ClientRegisterCapability
</span><span class="hs-identifier hs-var">SMethod_ClientRegisterCapability</span></span><span> </span><span class="annot"><span class="annottext">RegistrationParams
MessageParams
  @'ServerToClient @'Request 'Method_ClientRegisterCapability
</span><a href="#local-6989586621679208028"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">((Either
    (TResponseError @'ServerToClient 'Method_ClientRegisterCapability)
    (MessageResult
       @'ServerToClient @'Request 'Method_ClientRegisterCapability)
  -&gt; f ())
 -&gt; f (LspId @'ServerToClient 'Method_ClientRegisterCapability))
-&gt; (Either
      (TResponseError @'ServerToClient 'Method_ClientRegisterCapability)
      (MessageResult
         @'ServerToClient @'Request 'Method_ClientRegisterCapability)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient 'Method_ClientRegisterCapability)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208033"><span class="annot"><span class="annottext">Either
  (TResponseError @'ServerToClient 'Method_ClientRegisterCapability)
  (MessageResult
     @'ServerToClient @'Request 'Method_ClientRegisterCapability)
</span><a href="#local-6989586621679208033"><span class="hs-identifier hs-var">_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegistrationToken @t m -&gt; Maybe (RegistrationToken @t m)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RegistrationToken @t m -&gt; Maybe (RegistrationToken @t m))
-&gt; RegistrationToken @t m -&gt; Maybe (RegistrationToken @t m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m -&gt; RegistrationId @t m -&gt; RegistrationToken @t m
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
SMethod @'ClientToServer @t m
-&gt; RegistrationId @t m -&gt; RegistrationToken @t m
</span><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679208019"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679208031"><span class="hs-identifier hs-var">regId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208018"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction f (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; f ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ClientToServer
  @'Notification
  'Method_WorkspaceDidChangeConfiguration
-&gt; LspCoreLog
forall {f :: MessageDirection} {t :: MessageKind}
       (m :: Method f t).
SMethod @f @t m -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#CantRegister"><span class="hs-identifier hs-var">CantRegister</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ClientToServer
  @'Notification
  'Method_WorkspaceDidChangeConfiguration
</span><span class="hs-identifier hs-var">SMethod_WorkspaceDidChangeConfiguration</span></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
-&gt; f (Maybe (RegistrationToken @t m))
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (RegistrationToken @t m)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="annot"><span class="hs-comment">{- | Sends a @client/unregisterCapability@ request and removes the handler
 for that associated registration.
-}</span></span><span>
</span><span id="line-607"></span><span id="local-6989586621679206971"><span id="local-6989586621679206972"><span id="local-6989586621679206973"><span class="annot"><a href="Language.LSP.Server.Core.html#unregisterCapability"><span class="hs-identifier hs-type">unregisterCapability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206971"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206972"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206973"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206972"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-608"></span><span id="unregisterCapability"><span class="annot"><span class="annottext">unregisterCapability :: forall {t :: MessageKind} config (f :: * -&gt; *)
       (m :: Method 'ClientToServer t).
MonadLsp config f =&gt;
RegistrationToken @t m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#unregisterCapability"><span class="hs-identifier hs-var hs-var">unregisterCapability</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span id="local-6989586621679208048"><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679208048"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span id="local-6989586621679208049"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208049"><span class="hs-identifier hs-var">uuid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m -&gt; ClientNotOrReq @t m
forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679208048"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar (RegistrationMap 'Request))
-&gt; (RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ()
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var">resRegistrationsReq</span></a></span><span> </span><span class="annot"><span class="annottext">((RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ())
-&gt; (RegistrationMap 'Request -&gt; RegistrationMap 'Request) -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
-&gt; RegistrationMap 'Request -&gt; RegistrationMap 'Request
forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; SMethodMap @f2 @t2 v
</span><span class="hs-identifier hs-var">SMethodMap.delete</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679208048"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config
 -&gt; TVar (RegistrationMap 'Notification))
-&gt; (RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
-&gt; f ()
forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var">resRegistrationsNot</span></a></span><span> </span><span class="annot"><span class="annottext">((RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
 -&gt; f ())
-&gt; (RegistrationMap 'Notification -&gt; RegistrationMap 'Notification)
-&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
-&gt; RegistrationMap 'Notification -&gt; RegistrationMap 'Notification
forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; SMethodMap @f2 @t2 v
</span><span class="hs-identifier hs-var">SMethodMap.delete</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679208048"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot unregister capability for custom methods&quot;</span></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679208065"><span class="annot"><span class="annottext">unregistration :: TUnregistration @t m
</span><a href="#local-6989586621679208065"><span class="hs-identifier hs-var hs-var">unregistration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SMethod @'ClientToServer @t m -&gt; TUnregistration @t m
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text -&gt; SMethod @'ClientToServer @t m -&gt; TUnregistration @t m
</span><span class="hs-identifier hs-var">L.TUnregistration</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208049"><span class="hs-identifier hs-var">uuid</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679208048"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-615"></span><span>      </span><span id="local-6989586621679208067"><span class="annot"><span class="annottext">params :: UnregistrationParams
</span><a href="#local-6989586621679208067"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unregistration] -&gt; UnregistrationParams
</span><span class="hs-identifier hs-var">L.UnregistrationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TUnregistration @t m -&gt; Unregistration
forall {t :: MessageKind} (m :: Method 'ClientToServer t).
TUnregistration @t m -&gt; Unregistration
</span><span class="hs-identifier hs-var">toUntypedUnregistration</span></span><span> </span><span class="annot"><span class="annottext">TUnregistration @t m
</span><a href="#local-6989586621679208065"><span class="hs-identifier hs-var">unregistration</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-616"></span><span>  </span><span class="annot"><span class="annottext">f (LspId @'ServerToClient 'Method_ClientUnregisterCapability)
-&gt; f ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(f (LspId @'ServerToClient 'Method_ClientUnregisterCapability)
 -&gt; f ())
-&gt; f (LspId @'ServerToClient 'Method_ClientUnregisterCapability)
-&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_ClientUnregisterCapability
-&gt; MessageParams
     @'ServerToClient @'Request 'Method_ClientUnregisterCapability
-&gt; (Either
      (TResponseError
         @'ServerToClient 'Method_ClientUnregisterCapability)
      (MessageResult
         @'ServerToClient @'Request 'Method_ClientUnregisterCapability)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient 'Method_ClientUnregisterCapability)
forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      (TResponseError @'ServerToClient m)
      (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_ClientUnregisterCapability
</span><span class="hs-identifier hs-var">SMethod_ClientUnregisterCapability</span></span><span> </span><span class="annot"><span class="annottext">UnregistrationParams
MessageParams
  @'ServerToClient @'Request 'Method_ClientUnregisterCapability
</span><a href="#local-6989586621679208067"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">((Either
    (TResponseError
       @'ServerToClient 'Method_ClientUnregisterCapability)
    (MessageResult
       @'ServerToClient @'Request 'Method_ClientUnregisterCapability)
  -&gt; f ())
 -&gt; f (LspId @'ServerToClient 'Method_ClientUnregisterCapability))
-&gt; (Either
      (TResponseError
         @'ServerToClient 'Method_ClientUnregisterCapability)
      (MessageResult
         @'ServerToClient @'Request 'Method_ClientUnregisterCapability)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient 'Method_ClientUnregisterCapability)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208072"><span class="annot"><span class="annottext">Either
  (TResponseError
     @'ServerToClient 'Method_ClientUnregisterCapability)
  (MessageResult
     @'ServerToClient @'Request 'Method_ClientUnregisterCapability)
</span><a href="#local-6989586621679208072"><span class="hs-identifier hs-var">_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="annot"><span class="hs-comment">{- | Aggregate all diagnostics pertaining to a particular version of a document,
 by source, and sends a @textDocument/publishDiagnostics@ notification with
 the total (limited by the first parameter) whenever it is updated.
-}</span></span><span>
</span><span id="line-624"></span><span id="local-6989586621679206997"><span id="local-6989586621679206998"><span class="annot"><a href="Language.LSP.Server.Core.html#publishDiagnostics"><span class="hs-identifier hs-type">publishDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206997"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679206998"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Int32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Diagnostics.html#DiagnosticsBySource"><span class="hs-identifier hs-type">DiagnosticsBySource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679206998"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-625"></span><span id="publishDiagnostics"><span class="annot"><span class="annottext">publishDiagnostics :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
Int -&gt; NormalizedUri -&gt; Maybe Int32 -&gt; DiagnosticsBySource -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#publishDiagnostics"><span class="hs-identifier hs-var hs-var">publishDiagnostics</span></a></span></span><span> </span><span id="local-6989586621679208085"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679208085"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span></span><span> </span><span id="local-6989586621679208086"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679208086"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span id="local-6989586621679208087"><span class="annot"><span class="annottext">Maybe Int32
</span><a href="#local-6989586621679208087"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679208088"><span class="annot"><span class="annottext">DiagnosticsBySource
</span><a href="#local-6989586621679208088"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (m ()) -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(m (m ()) -&gt; m ()) -&gt; m (m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar DiagnosticStore)
-&gt; (DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ())
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar DiagnosticStore
forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var">resDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">((DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ()))
-&gt; (DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208089"><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208089"><span class="hs-identifier hs-var">oldDiags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679208090"><span class="annot"><span class="annottext">newDiags :: DiagnosticStore
</span><a href="#local-6989586621679208090"><span class="hs-identifier hs-var hs-var">newDiags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe Int32
-&gt; DiagnosticsBySource
-&gt; DiagnosticStore
</span><a href="Language.LSP.Diagnostics.html#updateDiagnostics"><span class="hs-identifier hs-var">updateDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208089"><span class="hs-identifier hs-var">oldDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679208086"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int32
</span><a href="#local-6989586621679208087"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticsBySource
</span><a href="#local-6989586621679208088"><span class="hs-identifier hs-var">diags</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span id="local-6989586621679208092"><span class="annot"><span class="annottext">mdp :: Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679208092"><span class="hs-identifier hs-var hs-var">mdp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe PublishDiagnosticsParams
</span><a href="Language.LSP.Diagnostics.html#getDiagnosticParamsFor"><span class="hs-identifier hs-var">getDiagnosticParamsFor</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679208085"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208090"><span class="hs-identifier hs-var">newDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679208086"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-628"></span><span>      </span><span id="local-6989586621679208094"><span class="annot"><span class="annottext">act :: m ()
</span><a href="#local-6989586621679208094"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679208092"><span class="hs-identifier hs-var">mdp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-629"></span><span>        </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679208095"><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679208095"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-631"></span><span>          </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage
  @'ServerToClient 'Method_TextDocumentPublishDiagnostics
-&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">L.fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(TNotificationMessage
   @'ServerToClient 'Method_TextDocumentPublishDiagnostics
 -&gt; FromServerMessage)
-&gt; TNotificationMessage
     @'ServerToClient 'Method_TextDocumentPublishDiagnostics
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; SMethod
     @'ServerToClient
     @'Notification
     'Method_TextDocumentPublishDiagnostics
-&gt; MessageParams
     @'ServerToClient
     @'Notification
     'Method_TextDocumentPublishDiagnostics
-&gt; TNotificationMessage
     @'ServerToClient 'Method_TextDocumentPublishDiagnostics
forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">L.TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><span class="hs-identifier hs-var">L.SMethod_TextDocumentPublishDiagnostics</span></span><span> </span><span class="annot"><span class="annottext">PublishDiagnosticsParams
MessageParams
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><a href="#local-6989586621679208095"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-632"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679208094"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208090"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="annot"><span class="hs-comment">{- | Remove all diagnostics from a particular source, and send the updates to
 the client.
-}</span></span><span>
</span><span id="line-639"></span><span id="local-6989586621679207004"><span id="local-6989586621679207005"><span class="annot"><a href="Language.LSP.Server.Core.html#flushDiagnosticsBySource"><span class="hs-identifier hs-type">flushDiagnosticsBySource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-640"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207004"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207005"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Max number of diagnostics to send</span></span><span>
</span><span id="line-642"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-644"></span><span>  </span><span class="annot"><a href="#local-6989586621679207005"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-645"></span><span id="flushDiagnosticsBySource"><span class="annot"><span class="annottext">flushDiagnosticsBySource :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
Int -&gt; Maybe Text -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#flushDiagnosticsBySource"><span class="hs-identifier hs-var hs-var">flushDiagnosticsBySource</span></a></span></span><span> </span><span id="local-6989586621679208112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679208112"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span></span><span> </span><span id="local-6989586621679208113"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679208113"><span class="hs-identifier hs-var">msource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (m ()) -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(m (m ()) -&gt; m ()) -&gt; m (m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar DiagnosticStore)
-&gt; (DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ())
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar DiagnosticStore
forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var">resDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">((DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ()))
-&gt; (DiagnosticStore -&gt; (m (), DiagnosticStore)) -&gt; m (m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208114"><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208114"><span class="hs-identifier hs-var">oldDiags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679208115"><span class="annot"><span class="annottext">newDiags :: DiagnosticStore
</span><a href="#local-6989586621679208115"><span class="hs-identifier hs-var hs-var">newDiags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore -&gt; Maybe Text -&gt; DiagnosticStore
</span><a href="Language.LSP.Diagnostics.html#flushBySource"><span class="hs-identifier hs-var">flushBySource</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208114"><span class="hs-identifier hs-var">oldDiags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679208113"><span class="hs-identifier hs-var">msource</span></a></span><span>
</span><span id="line-647"></span><span>      </span><span class="hs-comment">-- Send the updated diagnostics to the client</span><span>
</span><span id="line-648"></span><span>      </span><span id="local-6989586621679208117"><span class="annot"><span class="annottext">act :: m ()
</span><a href="#local-6989586621679208117"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NormalizedUri] -&gt; (NormalizedUri -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiagnosticStore -&gt; [NormalizedUri]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HM.keys</span></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208115"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NormalizedUri -&gt; m ()) -&gt; m ())
-&gt; (NormalizedUri -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208120"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679208120"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679208121"><span class="annot"><span class="annottext">mdp :: Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679208121"><span class="hs-identifier hs-var hs-var">mdp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe PublishDiagnosticsParams
</span><a href="Language.LSP.Diagnostics.html#getDiagnosticParamsFor"><span class="hs-identifier hs-var">getDiagnosticParamsFor</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679208112"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208115"><span class="hs-identifier hs-var">newDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679208120"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679208121"><span class="hs-identifier hs-var">mdp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-651"></span><span>          </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679208122"><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679208122"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>            </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage
  @'ServerToClient 'Method_TextDocumentPublishDiagnostics
-&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">L.fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(TNotificationMessage
   @'ServerToClient 'Method_TextDocumentPublishDiagnostics
 -&gt; FromServerMessage)
-&gt; TNotificationMessage
     @'ServerToClient 'Method_TextDocumentPublishDiagnostics
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; SMethod
     @'ServerToClient
     @'Notification
     'Method_TextDocumentPublishDiagnostics
-&gt; MessageParams
     @'ServerToClient
     @'Notification
     'Method_TextDocumentPublishDiagnostics
-&gt; TNotificationMessage
     @'ServerToClient 'Method_TextDocumentPublishDiagnostics
forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">L.TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><span class="hs-identifier hs-var">L.SMethod_TextDocumentPublishDiagnostics</span></span><span> </span><span class="annot"><span class="annottext">PublishDiagnosticsParams
MessageParams
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><a href="#local-6989586621679208122"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-654"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679208117"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679208115"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="annot"><span class="hs-comment">{- | The changes in a workspace edit should be applied from the end of the file
 toward the start. Sort them into this order.
-}</span></span><span>
</span><span id="line-661"></span><span class="annot"><a href="Language.LSP.Server.Core.html#reverseSortEdit"><span class="hs-identifier hs-type">reverseSortEdit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span>
</span><span id="line-662"></span><span id="reverseSortEdit"><span class="annot"><span class="annottext">reverseSortEdit :: WorkspaceEdit -&gt; WorkspaceEdit
</span><a href="Language.LSP.Server.Core.html#reverseSortEdit"><span class="hs-identifier hs-var hs-var">reverseSortEdit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span> </span><span id="local-6989586621679208125"><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679208125"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621679208126"><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679208126"><span class="hs-identifier hs-var">dcs</span></a></span></span><span> </span><span id="local-6989586621679208127"><span class="annot"><span class="annottext">Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
</span><a href="#local-6989586621679208127"><span class="hs-identifier hs-var">anns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
-&gt; Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
-&gt; WorkspaceEdit
</span><span class="hs-identifier hs-var">L.WorkspaceEdit</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679208128"><span class="hs-identifier hs-var">cs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679208129"><span class="hs-identifier hs-var">dcs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
</span><a href="#local-6989586621679208127"><span class="hs-identifier hs-var">anns</span></a></span><span>
</span><span id="line-663"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-664"></span><span>  </span><span class="annot"><a href="#local-6989586621679208128"><span class="hs-identifier hs-type">cs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TextEdit</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>  </span><span id="local-6989586621679208128"><span class="annot"><span class="annottext">cs' :: Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679208128"><span class="hs-identifier hs-var hs-var">cs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Uri [TextEdit] -&gt; Map Uri [TextEdit])
-&gt; Maybe (Map Uri [TextEdit]) -&gt; Maybe (Map Uri [TextEdit])
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Map Uri [TextEdit] -&gt; Map Uri [TextEdit])
 -&gt; Maybe (Map Uri [TextEdit]) -&gt; Maybe (Map Uri [TextEdit]))
-&gt; (([TextEdit] -&gt; [TextEdit])
    -&gt; Map Uri [TextEdit] -&gt; Map Uri [TextEdit])
-&gt; ([TextEdit] -&gt; [TextEdit])
-&gt; Maybe (Map Uri [TextEdit])
-&gt; Maybe (Map Uri [TextEdit])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([TextEdit] -&gt; [TextEdit])
-&gt; Map Uri [TextEdit] -&gt; Map Uri [TextEdit]
forall a b. (a -&gt; b) -&gt; Map Uri a -&gt; Map Uri b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit] -&gt; [TextEdit]
</span><a href="#local-6989586621679208130"><span class="hs-identifier hs-var">sortTextEdits</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679208125"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><a href="#local-6989586621679208129"><span class="hs-identifier hs-type">dcs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span class="hs-special">]</span><span>
</span><span id="line-668"></span><span>  </span><span id="local-6989586621679208129"><span class="annot"><span class="annottext">dcs' :: Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679208129"><span class="hs-identifier hs-var hs-var">dcs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
 -&gt; [TextDocumentEdit
     |? (CreateFile |? (RenameFile |? DeleteFile))])
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(([TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
  -&gt; [TextDocumentEdit
      |? (CreateFile |? (RenameFile |? DeleteFile))])
 -&gt; Maybe
      [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
 -&gt; Maybe
      [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))])
-&gt; (((TextDocumentEdit
      |? (CreateFile |? (RenameFile |? DeleteFile)))
     -&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
    -&gt; [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
    -&gt; [TextDocumentEdit
        |? (CreateFile |? (RenameFile |? DeleteFile))])
-&gt; ((TextDocumentEdit
     |? (CreateFile |? (RenameFile |? DeleteFile)))
    -&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
 -&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
-&gt; [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
</span><a href="#local-6989586621679208132"><span class="hs-identifier hs-var">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679208126"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>  </span><span class="annot"><a href="#local-6989586621679208130"><span class="hs-identifier hs-type">sortTextEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span class="hs-special">]</span><span>
</span><span id="line-671"></span><span>  </span><span id="local-6989586621679208130"><span class="annot"><span class="annottext">sortTextEdits :: [TextEdit] -&gt; [TextEdit]
</span><a href="#local-6989586621679208130"><span class="hs-identifier hs-var hs-var">sortTextEdits</span></a></span></span><span> </span><span id="local-6989586621679208133"><span class="annot"><span class="annottext">[TextEdit]
</span><a href="#local-6989586621679208133"><span class="hs-identifier hs-var">edits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TextEdit -&gt; Down Range) -&gt; [TextEdit] -&gt; [TextEdit]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Down Range
forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Down Range)
-&gt; (TextEdit -&gt; Range) -&gt; TextEdit -&gt; Down Range
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TextEdit -&gt; Getting Range TextEdit Range -&gt; Range
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Range TextEdit Range
forall s a. HasRange s a =&gt; Lens' s a
Lens' TextEdit Range
</span><span class="hs-identifier hs-var">L.range</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit]
</span><a href="#local-6989586621679208133"><span class="hs-identifier hs-var">edits</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><a href="#local-6989586621679208132"><span class="hs-identifier hs-type">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span>
</span><span id="line-674"></span><span>  </span><span id="local-6989586621679208132"><span class="annot"><span class="annottext">sortOnlyTextDocumentEdits :: (TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
</span><a href="#local-6989586621679208132"><span class="hs-identifier hs-var hs-var">sortOnlyTextDocumentEdits</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.TextDocumentEdit</span></span><span> </span><span id="local-6989586621679208138"><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
</span><a href="#local-6989586621679208138"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span id="local-6989586621679208139"><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679208139"><span class="hs-identifier hs-var">edits</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TextDocumentEdit
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
forall a b. a -&gt; a |? b
</span><span class="hs-identifier hs-var">L.InL</span></span><span> </span><span class="annot"><span class="annottext">(TextDocumentEdit
 -&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; TextDocumentEdit
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
-&gt; [TextEdit |? AnnotatedTextEdit] -&gt; TextDocumentEdit
</span><span class="hs-identifier hs-var">L.TextDocumentEdit</span></span><span> </span><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
</span><a href="#local-6989586621679208138"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679208140"><span class="hs-identifier hs-var">edits'</span></a></span><span>
</span><span id="line-675"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621679208140"><span class="annot"><span class="annottext">edits' :: [TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679208140"><span class="hs-identifier hs-var hs-var">edits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TextEdit |? AnnotatedTextEdit) -&gt; Down Range)
-&gt; [TextEdit |? AnnotatedTextEdit]
-&gt; [TextEdit |? AnnotatedTextEdit]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Down Range
forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Down Range)
-&gt; ((TextEdit |? AnnotatedTextEdit) -&gt; Range)
-&gt; (TextEdit |? AnnotatedTextEdit)
-&gt; Down Range
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TextEdit |? AnnotatedTextEdit) -&gt; Range
</span><a href="#local-6989586621679208141"><span class="hs-identifier hs-var">editRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679208139"><span class="hs-identifier hs-var">edits</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><a href="#local-6989586621679208132"><span class="hs-identifier hs-var">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InR</span></span><span> </span><span id="local-6989586621679208143"><span class="annot"><span class="annottext">CreateFile |? (RenameFile |? DeleteFile)
</span><a href="#local-6989586621679208143"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CreateFile |? (RenameFile |? DeleteFile))
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
forall a b. b -&gt; a |? b
</span><span class="hs-identifier hs-var">L.InR</span></span><span> </span><span class="annot"><span class="annottext">CreateFile |? (RenameFile |? DeleteFile)
</span><a href="#local-6989586621679208143"><span class="hs-identifier hs-var">others</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><a href="#local-6989586621679208141"><span class="hs-identifier hs-type">editRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">L.|?</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.AnnotatedTextEdit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Range</span></span><span>
</span><span id="line-680"></span><span>  </span><span id="local-6989586621679208141"><span class="annot"><span class="annottext">editRange :: (TextEdit |? AnnotatedTextEdit) -&gt; Range
</span><a href="#local-6989586621679208141"><span class="hs-identifier hs-var hs-var">editRange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InR</span></span><span> </span><span id="local-6989586621679208144"><span class="annot"><span class="annottext">AnnotatedTextEdit
</span><a href="#local-6989586621679208144"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedTextEdit
</span><a href="#local-6989586621679208144"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedTextEdit -&gt; Getting Range AnnotatedTextEdit Range -&gt; Range
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Range AnnotatedTextEdit Range
forall s a. HasRange s a =&gt; Lens' s a
Lens' AnnotatedTextEdit Range
</span><span class="hs-identifier hs-var">L.range</span></span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><a href="#local-6989586621679208141"><span class="hs-identifier hs-var">editRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InL</span></span><span> </span><span id="local-6989586621679208145"><span class="annot"><span class="annottext">TextEdit
</span><a href="#local-6989586621679208145"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TextEdit
</span><a href="#local-6989586621679208145"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TextEdit -&gt; Getting Range TextEdit Range -&gt; Range
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Range TextEdit Range
forall s a. HasRange s a =&gt; Lens' s a
Lens' TextEdit Range
</span><span class="hs-identifier hs-var">L.range</span></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- CONFIG</span><span>
</span><span id="line-685"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="annot"><span class="hs-comment">-- | Given a new config object, try to update our config with it.</span></span><span>
</span><span id="line-688"></span><span id="local-6989586621679207031"><span id="local-6989586621679207032"><span class="annot"><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-type">tryChangeConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207031"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207032"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679207031"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207031"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-689"></span><span id="tryChangeConfig"><span class="annot"><span class="annottext">tryChangeConfig :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; Value -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-var hs-var">tryChangeConfig</span></a></span></span><span> </span><span id="local-6989586621679208166"><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208166"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679208167"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208167"><span class="hs-identifier hs-var">newConfigObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-690"></span><span>  </span><span id="local-6989586621679208168"><span class="annot"><span class="annottext">config -&gt; Value -&gt; Either Text config
</span><a href="#local-6989586621679208168"><span class="hs-identifier hs-var">parseCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (LanguageContextEnv config)
  IO
  (config -&gt; Value -&gt; Either Text config)
-&gt; LspT config IO (config -&gt; Value -&gt; Either Text config)
forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (LanguageContextEnv config)
   IO
   (config -&gt; Value -&gt; Either Text config)
 -&gt; LspT config IO (config -&gt; Value -&gt; Either Text config))
-&gt; ReaderT
     (LanguageContextEnv config)
     IO
     (config -&gt; Value -&gt; Either Text config)
-&gt; LspT config IO (config -&gt; Value -&gt; Either Text config)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config
 -&gt; config -&gt; Value -&gt; Either Text config)
-&gt; ReaderT
     (LanguageContextEnv config)
     IO
     (config -&gt; Value -&gt; Either Text config)
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; config -&gt; Value -&gt; Either Text config
forall config.
LanguageContextEnv config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#resParseConfig"><span class="hs-identifier hs-var">resParseConfig</span></a></span><span>
</span><span id="line-691"></span><span>  </span><span id="local-6989586621679208170"><span class="annot"><span class="annottext">Either Text config
</span><a href="#local-6989586621679208170"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; TVar config)
-&gt; (config -&gt; (Either Text config, config))
-&gt; m (Either Text config)
forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar config
forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span> </span><span class="annot"><span class="annottext">((config -&gt; (Either Text config, config))
 -&gt; m (Either Text config))
-&gt; (config -&gt; (Either Text config, config))
-&gt; m (Either Text config)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679208171"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208171"><span class="hs-identifier hs-var">oldConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">config -&gt; Value -&gt; Either Text config
</span><a href="#local-6989586621679208168"><span class="hs-identifier hs-var">parseCfg</span></a></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208171"><span class="hs-identifier hs-var">oldConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208167"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679208172"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208172"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text config
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208172"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208171"><span class="hs-identifier hs-var">oldConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679208173"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208173"><span class="hs-identifier hs-var">newConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">config -&gt; Either Text config
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208173"><span class="hs-identifier hs-var">newConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208173"><span class="hs-identifier hs-var">newConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text config
</span><a href="#local-6989586621679208170"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679208174"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208174"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>      </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208166"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; m ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-var">ConfigurationParseError</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208167"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208174"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679208175"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208175"><span class="hs-identifier hs-var">newConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>      </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208166"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; m ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-var">NewConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208167"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-699"></span><span>      </span><span id="local-6989586621679208177"><span class="annot"><span class="annottext">config -&gt; IO ()
</span><a href="#local-6989586621679208177"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) IO (config -&gt; IO ())
-&gt; LspT config IO (config -&gt; IO ())
forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (LanguageContextEnv config) IO (config -&gt; IO ())
 -&gt; LspT config IO (config -&gt; IO ()))
-&gt; ReaderT (LanguageContextEnv config) IO (config -&gt; IO ())
-&gt; LspT config IO (config -&gt; IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; config -&gt; IO ())
-&gt; ReaderT (LanguageContextEnv config) IO (config -&gt; IO ())
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; config -&gt; IO ()
forall config. LanguageContextEnv config -&gt; config -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resOnConfigChange"><span class="hs-identifier hs-var">resOnConfigChange</span></a></span><span>
</span><span id="line-700"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">config -&gt; IO ()
</span><a href="#local-6989586621679208177"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679208175"><span class="hs-identifier hs-var">newConfig</span></a></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="annot"><span class="hs-comment">{- | Send a `worksapce/configuration` request to update the server's config.

 This is called automatically in response to `workspace/didChangeConfiguration` notifications
 from the client, so should not normally be called manually.
-}</span></span><span>
</span><span id="line-707"></span><span id="local-6989586621679207041"><span id="local-6989586621679207042"><span class="annot"><a href="Language.LSP.Server.Core.html#requestConfigUpdate"><span class="hs-identifier hs-type">requestConfigUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207042"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679207041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-708"></span><span id="requestConfigUpdate"><span class="annot"><span class="annottext">requestConfigUpdate :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#requestConfigUpdate"><span class="hs-identifier hs-var hs-var">requestConfigUpdate</span></a></span></span><span> </span><span id="local-6989586621679208206"><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208206"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-709"></span><span>  </span><span id="local-6989586621679208207"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679208207"><span class="hs-identifier hs-var">caps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) IO ClientCapabilities
-&gt; LspT config IO ClientCapabilities
forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (LanguageContextEnv config) IO ClientCapabilities
 -&gt; LspT config IO ClientCapabilities)
-&gt; ReaderT (LanguageContextEnv config) IO ClientCapabilities
-&gt; LspT config IO ClientCapabilities
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; ClientCapabilities)
-&gt; ReaderT (LanguageContextEnv config) IO ClientCapabilities
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; ClientCapabilities
forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679208208"><span class="annot"><span class="annottext">supportsConfiguration :: Bool
</span><a href="#local-6989586621679208208"><span class="hs-identifier hs-var hs-var">supportsConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679208207"><span class="hs-identifier hs-var">caps</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
-&gt; Getting (First Bool) ClientCapabilities Bool -&gt; Maybe Bool
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">(Maybe WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; ClientCapabilities -&gt; Const @(*) (First Bool) ClientCapabilities
forall s a. HasWorkspace s a =&gt; Lens' s a
Lens' ClientCapabilities (Maybe WorkspaceClientCapabilities)
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">((Maybe WorkspaceClientCapabilities
  -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
 -&gt; ClientCapabilities
 -&gt; Const @(*) (First Bool) ClientCapabilities)
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; Maybe WorkspaceClientCapabilities
    -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; Getting (First Bool) ClientCapabilities Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; Maybe WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities)
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((WorkspaceClientCapabilities
  -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
 -&gt; Maybe WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities))
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; WorkspaceClientCapabilities
    -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; (Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; Maybe WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) (Maybe WorkspaceClientCapabilities)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
-&gt; WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) WorkspaceClientCapabilities
forall s a. HasConfiguration s a =&gt; Lens' s a
Lens' WorkspaceClientCapabilities (Maybe Bool)
</span><span class="hs-identifier hs-var">L.configuration</span></span><span> </span><span class="annot"><span class="annottext">((Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
 -&gt; WorkspaceClientCapabilities
 -&gt; Const @(*) (First Bool) WorkspaceClientCapabilities)
-&gt; ((Bool -&gt; Const @(*) (First Bool) Bool)
    -&gt; Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool))
-&gt; (Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; WorkspaceClientCapabilities
-&gt; Const @(*) (First Bool) WorkspaceClientCapabilities
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Const @(*) (First Bool) Bool)
-&gt; Maybe Bool -&gt; Const @(*) (First Bool) (Maybe Bool)
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679208208"><span class="hs-identifier hs-var">supportsConfiguration</span></a></span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-713"></span><span>      </span><span id="local-6989586621679208210"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208210"><span class="hs-identifier hs-var">section</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (LanguageContextEnv config) IO Text -&gt; LspT config IO Text
forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (LanguageContextEnv config) IO Text
 -&gt; LspT config IO Text)
-&gt; ReaderT (LanguageContextEnv config) IO Text
-&gt; LspT config IO Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; Text)
-&gt; ReaderT (LanguageContextEnv config) IO Text
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; Text
forall config. LanguageContextEnv config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#resConfigSection"><span class="hs-identifier hs-var">resConfigSection</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="annot"><span class="annottext">m (LspId @'ServerToClient 'Method_WorkspaceConfiguration) -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m (LspId @'ServerToClient 'Method_WorkspaceConfiguration) -&gt; m ())
-&gt; m (LspId @'ServerToClient 'Method_WorkspaceConfiguration)
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_WorkspaceConfiguration
-&gt; MessageParams
     @'ServerToClient @'Request 'Method_WorkspaceConfiguration
-&gt; (Either
      (TResponseError @'ServerToClient 'Method_WorkspaceConfiguration)
      (MessageResult
         @'ServerToClient @'Request 'Method_WorkspaceConfiguration)
    -&gt; m ())
-&gt; m (LspId @'ServerToClient 'Method_WorkspaceConfiguration)
forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      (TResponseError @'ServerToClient m)
      (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request 'Method_WorkspaceConfiguration
</span><span class="hs-identifier hs-var">SMethod_WorkspaceConfiguration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ConfigurationItem] -&gt; ConfigurationParams
</span><span class="hs-identifier hs-var">ConfigurationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Uri -&gt; Maybe Text -&gt; ConfigurationItem
</span><span class="hs-identifier hs-var">ConfigurationItem</span></span><span> </span><span class="annot"><span class="annottext">Maybe Uri
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679208210"><span class="hs-identifier hs-var">section</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Either
    (TResponseError @'ServerToClient 'Method_WorkspaceConfiguration)
    (MessageResult
       @'ServerToClient @'Request 'Method_WorkspaceConfiguration)
  -&gt; m ())
 -&gt; m (LspId @'ServerToClient 'Method_WorkspaceConfiguration))
-&gt; (Either
      (TResponseError @'ServerToClient 'Method_WorkspaceConfiguration)
      (MessageResult
         @'ServerToClient @'Request 'Method_WorkspaceConfiguration)
    -&gt; m ())
-&gt; m (LspId @'ServerToClient 'Method_WorkspaceConfiguration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679208214"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208214"><span class="hs-identifier hs-var">newConfigObject</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog) -&gt; Value -&gt; m ()
forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; Value -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-var">tryChangeConfig</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208206"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679208214"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679208215"><span class="annot"><span class="annottext">MessageResult
  @'ServerToClient @'Request 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679208215"><span class="hs-identifier hs-var">sections</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208206"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; m ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-var">WrongConfigSections</span></a></span><span> </span><span class="annot"><span class="annottext">[Value]
MessageResult
  @'ServerToClient @'Request 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679208215"><span class="hs-identifier hs-var">sections</span></a></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-717"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679208217"><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679208217"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208206"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; m ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
-&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-var">BadConfigurationResponse</span></a></span><span> </span><span class="annot"><span class="annottext">TResponseError @'ServerToClient 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679208217"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-718"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679208206"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
-&gt; WithSeverity LspCoreLog -&gt; m ()
forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">LspCoreLog -&gt; Severity -&gt; WithSeverity LspCoreLog
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- CONFIG</span><span>
</span><span id="line-722"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="annot"><span class="hs-comment">-- | Checks if the server has received a 'shutdown' request.</span></span><span>
</span><span id="line-725"></span><span id="local-6989586621679207050"><span id="local-6989586621679207051"><span class="annot"><a href="Language.LSP.Server.Core.html#isShuttingDown"><span class="hs-identifier hs-type">isShuttingDown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207050"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207051"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207050"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-726"></span><span id="isShuttingDown"><span class="annot"><span class="annottext">isShuttingDown :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
m Bool
</span><a href="Language.LSP.Server.Core.html#isShuttingDown"><span class="hs-identifier hs-var hs-var">isShuttingDown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-727"></span><span>  </span><span id="local-6989586621679208238"><span class="annot"><span class="annottext">Barrier ()
</span><a href="#local-6989586621679208238"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; Barrier ()
forall config. LanguageContextState config -&gt; Barrier ()
</span><a href="Language.LSP.Server.Core.html#resShutdown"><span class="hs-identifier hs-var">resShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; Barrier ())
-&gt; (LanguageContextEnv config -&gt; LanguageContextState config)
-&gt; LanguageContextEnv config
-&gt; Barrier ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; LanguageContextState config
forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; Barrier ())
-&gt; m (LanguageContextEnv config) -&gt; m (Barrier ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span id="local-6989586621679208239"><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679208239"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ()) -&gt; m (Maybe ())
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ()) -&gt; m (Maybe ())) -&gt; IO (Maybe ()) -&gt; m (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Barrier () -&gt; IO (Maybe ())
forall a. Barrier a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">C.waitBarrierMaybe</span></span><span> </span><span class="annot"><span class="annottext">Barrier ()
</span><a href="#local-6989586621679208238"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m Bool) -&gt; Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679208239"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><span class="annottext">Maybe ()
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span class="annot"><span class="hs-comment">-- | Blocks until the server receives a 'shutdown' request.</span></span><span>
</span><span id="line-734"></span><span id="local-6989586621679207055"><span id="local-6989586621679207056"><span class="annot"><a href="Language.LSP.Server.Core.html#waitShuttingDown"><span class="hs-identifier hs-type">waitShuttingDown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679207055"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679207056"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679207055"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-735"></span><span id="waitShuttingDown"><span class="annot"><span class="annottext">waitShuttingDown :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
m ()
</span><a href="Language.LSP.Server.Core.html#waitShuttingDown"><span class="hs-identifier hs-var hs-var">waitShuttingDown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>  </span><span id="local-6989586621679208256"><span class="annot"><span class="annottext">Barrier ()
</span><a href="#local-6989586621679208256"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; Barrier ()
forall config. LanguageContextState config -&gt; Barrier ()
</span><a href="Language.LSP.Server.Core.html#resShutdown"><span class="hs-identifier hs-var">resShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextState config -&gt; Barrier ())
-&gt; (LanguageContextEnv config -&gt; LanguageContextState config)
-&gt; LanguageContextEnv config
-&gt; Barrier ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config -&gt; LanguageContextState config
forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv config -&gt; Barrier ())
-&gt; m (LanguageContextEnv config) -&gt; m (Barrier ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (LanguageContextEnv config)
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Barrier () -&gt; IO ()
forall a. Barrier a -&gt; IO a
</span><span class="hs-identifier hs-var">C.waitBarrier</span></span><span> </span><span class="annot"><span class="annottext">Barrier ()
</span><a href="#local-6989586621679208256"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="hs-comment">{- Note [LSP configuration]
LSP configuration is a huge mess.
- The configuration model of the client is not specified
- Many of the configuration messages are not specified in what they should return

In particular, configuration appears in three places:
1. The `initializationOptions` field of the `initialize` request.
  - The contents of this are unspecified. &quot;User provided initialization options&quot;.
2. The `settings` field of the `workspace/didChangeConfiguration` notification.
  - The contents of this are unspecified. &quot;The actual changed settings&quot;.
3. The `section` field of the response to the `workspace/configuration` request.
  - This at least says it should be the settings corresponding to the sections
    specified in the request.

It's very hard to know what to do here. In particular, the first two cases seem
like they could include arbitrary configuration from the client that might not
relate to you. How you locate &quot;your&quot; settings is unclear.

We are on firmer ground with case 3. Then at least it seems that we can pick
a configuration section, just always ask for that, and require clients to use
that for our settings. Furthermore, this is the method that is encouraged by the
specification designers: https://github.com/microsoft/language-server-protocol/issues/567#issuecomment-420589320.

For this reason we mostly try and rely on `workspace/configuration`. That means
three things:
- We require servers to give a specific configuration section for us to use
  when requesting configuration.
- We can try and make sense of `initializationOptions`, but regardless we should
  send a `workspace/configuration` request afterwards (in the handler for the
  `initialized` notification, which is the earliest we can send messages:
  https://github.com/microsoft/language-server-protocol/issues/567#issuecomment-953772465)
- We can try and make sense of `didChangeConfiguration`, but regardless we should
  send a `workspace/configuration` request afterwards

We do try to make sense of the first two cases also, especially because clients do
not have to support `workspace/configuration`! In practice,
many clients seem to follow the sensible approach laid out here:
https://github.com/microsoft/language-server-protocol/issues/972#issuecomment-626668243

To make this work, we try to be tolerant by using the following strategy.
When we receive a configuration object from any of the sources above, we first
check to see if it has a field corresponding to our configuration section. If it
does, then we assume that it our config and try to parse it. If it does not, we
try to parse the entire config object. This hopefully lets us handle a variety
of sensible cases where the client sends us mostly our config, either wrapped
in our section or not.
-}</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span class="hs-comment">{- Note [Client- versus server-initiated progress]
The protocol supports both client- and server-initiated progress. Client-initiated progress
is simpler: the client gives you a progress token, and then you use that to report progress.
Server-initiated progress is more complex: you need to send a request to the client to tell
them about the token you want to use, and only after that can you send updates using it.
-}</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="hs-comment">{- Note [Delayed progress reporting]
Progress updates can be very noisy by default. There are two ways this can happen:
- Creating progress notifications for very short-lived operations that don't deserve them.
  This directs the user's attention to something that then immediately ceases to exist,
  which is annoying, the more so if it happens frequently.
- Very frequently updating progress information.

Now, in theory the client could deal with this for us. Probably they _should_: working
out how to display an (accurate) series of progress notifications from the server seems
like the client's job. Nonetheless, this does not always happen, and so it is helpful
to moderate the spam.

For this reason we have configurable delays on starting progress tracking and on sending
updates. However, the defaults are set to 0, so it's opt-in.
-}</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-comment">{- Note [Request cancellation]
Request cancellation is a bit strange.

We need to in fact assume that all requests are cancellable, see
https://github.com/microsoft/language-server-protocol/issues/1159.

The 'cancellable' property that we can set when making progress reports just
affects whether the client should show a 'Cancel' button to the user in the UI.
The client can still always choose to cancel for another reason.
-}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="hs-comment">{- Note [Shutdown]
The 'shutdown' request basically tells the server to clean up and stop doing things.
In particular, it allows us to ignore or reject all further messages apart from 'exit'.

We also provide a `Barrier` that indicates whether or not we are shutdown, this can
be convenient, e.g. you can race a thread against `waitBarrier` to have it automatically
be cancelled when we receive `shutdown`.

Shutdown is a request, and the client won't send `exit` until a server responds, so if you
want to be sure that some cleanup happens, you need to ensure we don't respond to `shutdown`
until it's done. The best way to do this is just to install a specific `shutdown` handler.

After the `shutdown` request, we don't handle any more requests and notifications other than
`exit`. We also don't handle any more responses to requests we have sent but just throw the
responses away.
-}</span><span>
</span><span id="line-837"></span></pre></body></html>